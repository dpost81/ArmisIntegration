<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_hub_action_type_definition">
    <sys_hub_action_type_definition action="INSERT_OR_UPDATE">
        <access>public</access>
        <acls/>
        <action_template/>
        <active>true</active>
        <annotation/>
        <callable_by_client_api>false</callable_by_client_api>
        <category/>
        <copied_from/>
        <copied_from_name/>
        <description/>
        <ih_action>false</ih_action>
        <internal_name>up_uploadarpbatch_v21</internal_name>
        <label_cache>[{"name":"{{action.max_seconds}}","label":"action➛max_seconds","type":"action","ref":""},{"name":"{{step[9c44111f-3494-4908-9eca-f8468b3064d0].variable}}","label":"step➛Script step➛variable","type":"step","ref":""},{"name":"{{step[9c44111f-3494-4908-9eca-f8468b3064d0].debug}}","label":"step➛Script step➛debug","type":"step","ref":""}]</label_cache>
        <latest_snapshot/>
        <master_snapshot/>
        <name>UP_UploadBatches (v2.1)</name>
        <natlang/>
        <outputs/>
        <state>draft</state>
        <sys_class_name>sys_hub_action_type_definition</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 20:05:05</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_domain>global</sys_domain>
        <sys_id>2f83678c1b969c104ca7edf9bc4bcb28</sys_id>
        <sys_mod_count>14</sys_mod_count>
        <sys_name>UP_UploadBatches (v2.1)</sys_name>
        <sys_overrides/>
        <sys_package display_value="Armis Integration" source="x_fmcna_armis_inte">7574b5e3dbf4d050cb24431e13961986</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name>sys_hub_action_type_definition_2f83678c1b969c104ca7edf9bc4bcb28</sys_update_name>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 23:23:12</sys_updated_on>
        <system_level>false</system_level>
        <type/>
    </sys_hub_action_type_definition>
    <sys_variable_value action="delete_multiple" query="document_key=2f83678c1b969c104ca7edf9bc4bcb28"/>
    <sys_hub_step_instance action="delete_multiple" query="action=2f83678c1b969c104ca7edf9bc4bcb28^sys_idNOT IN67123b081b1a9c104ca7edf9bc4bcb17"/>
    <sys_hub_step_instance action="INSERT_OR_UPDATE">
        <action display_value="UP_UploadBatches (v2.1)">2f83678c1b969c104ca7edf9bc4bcb28</action>
        <cid>9c44111f-3494-4908-9eca-f8468b3064d0</cid>
        <extended_inputs/>
        <extended_inputs/>
        <extended_outputs/>
        <icon/>
        <inputs/>
        <label>Script step</label>
        <order>1</order>
        <outputs/>
        <section/>
        <step_type display_value="Script">106afb6647032200b4fad7527c9a71e7</step_type>
        <sys_class_name>sys_hub_step_instance</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:42</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>67123b081b1a9c104ca7edf9bc4bcb17</sys_id>
        <sys_mod_count>13</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 23:23:12</sys_updated_on>
    </sys_hub_step_instance>
    <sys_variable_value action="delete_multiple" query="document_key=67123b081b1a9c104ca7edf9bc4bcb17"/>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>67123b081b1a9c104ca7edf9bc4bcb17</document_key>
        <order>400</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:43</sys_created_on>
        <sys_id>27123b081b1a9c104ca7edf9bc4bcb25</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 21:08:43</sys_updated_on>
        <value>35aa573fd7802200bdbaee5b5e610375</value>
        <variable display_value="">f5e56d79b3101300176b051a16a8dce4</variable>
    </sys_variable_value>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>67123b081b1a9c104ca7edf9bc4bcb17</document_key>
        <order>600</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:43</sys_created_on>
        <sys_id>e7123b081b1a9c104ca7edf9bc4bcb25</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 23:23:12</sys_updated_on>
        <value>/* 

This function uploads batches from the ARP, Key Attribute, Property, and Application tables. (In that order.)

For each operation:
1. Pull up to 2000 records and set their status to PROCESSING.
2. Compose a JSON payload or a CSV attachment with the contents.
3. Execute the REST API call and document the results. If it succeeds, set all 1000 records to COMPLETED, otherwise reset them to PENDING.

Operations should be done precisely in the order of ARP, then Key Attribute, then Property, then Application. However, because more ARPs may come in while the last stack of ARPs is processing, snapshots of the counts of each will be taken at the beginning to ensure that the system doesn't get bogged down doing a handful of ARPs over and over and nothing else.

*/

//FUNCTION LIBRARY (v0.4) -- THESE FUNCTIONS HAVE BEEN MINIFIED.
//FOR FULL DOCUMENTAITON AND A CURRENT COPY, SEE THE ACTION "(vX.X) FUNCTION_LIBRARY"
function now(){return(new GlideDateTime).getNumericValue()}function includes(e,t){for(var r=0;r&lt;e.length;r++)if(e[r]==t)return!0;return!1}function digest(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return t&gt;&gt;&gt;0}function generateID(){var e="";arr="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var t=6;t&gt;0;t--)e+=arr[Math.floor(Math.random()*arr.length)];return e}function insertOrUpdate(e){var t={},r=now();null==e.unique_pairs&amp;&amp;(e.unique_pairs=[]);try{var a=new GlideRecord(e.table);if(0!=e.unique_pairs.length){for(var i=0;i&lt;e.unique_pairs.length;i++)a.addQuery(e.unique_pairs[i][0],e.unique_pairs[i][1]);a.query()}if(0==a.getRowCount()){a.initialize();for(i=0;i&lt;e.unique_pairs.length;i++)a[e.unique_pairs[i][0]]=e.unique_pairs[i][1];for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.insert(),t.operation="insert"}else{for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.updateMultiple(),t.operation="update"}}catch(e){t.operation="error: "+e}return t.time_delta=now()-r,t}function writeToAPILog(e){null==e.payload&amp;&amp;(e.payload=""),null==e.response_body&amp;&amp;(e.response_body="");var t={table:"x_fmcna_armis_inte_armis_rest_api_log"};return t.update_pairs=[["execution_id",e.id],["api_endpoint",e.endpoint],["payload",e.payload.substring(0,1999)],["response_code",e.response_code],["response_body",e.response_body.substring(0,1999)],["query_submitted_at",e.start_time],["query_response_time_ms",e.time_delta_ms]],insertOrUpdate(t)}function queueProperty(e){if(null==e.name||""==e.name)return{operation:"error: empty name",time_delta:0};if(null==e.value||""==e.value)return{operation:"error: empty value",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_property_upload"};return t.update_pairs=[["armis_device_id",e.armis_id],["property_name",e.name],["property_value",e.value],["execution_id",e.execution_id],["status","PENDING"]],insertOrUpdate(t)}function queueARP(e){if(null==e.mac||""==e.mac)return{operation:"error: empty mac",time_delta:0};if(null==e.ip||""==e.ip)return{operation:"error: empty ip",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_arp_table"};return t.update_pairs=[["execution_id",e.execution_id],["mac",e.mac],["ip",e.ip],["status","PENDING"]],insertOrUpdate(t)}function queueKeyAttribute(e){if(!(null!=e.armis_id&amp;&amp;""!=e.armis_id||null!=e.mac&amp;&amp;""!=e.mac))return{operation:"error: must have either a MAC or an Armis ID",time_delta:0};if(allowed_attributes=["CATEGORY","IP","LAST_SEEN","MODEL","NAME","OS","OS_VERSION","TAG","TYPE","USER"],0==includes(allowed_attributes,e.attribute))return{operation:"error: attribute '"+e.attribute+"' is not valid.",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_key_attribute"};return t.update_pairs=[["execution_id",e.execution_id],["armis_device_id",e.mac],["armis_mac",e.mac],["attribute",e.attribute],["value",e.value],["status","PENDING"]],insertOrUpdate(t)}function queueApplication(e){if(null==e.armis_id||""==e.armis_id)return{operation:"error: Armis ID cannot be empty",time_delta:0};if(null==e.name||""==e.name)return{operation:"error: Software name cannot be empty",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_application_upload"};return t.update_pairs=[["execution_id",e.execution_id],["armis_device_id",e.mac],["application_name",e.name],["application_version",e.version],["status","PENDING"]],insertOrUpdate(t)}function writeToActionLog(e){var t={table:"x_fmcna_armis_inte_armis_action_log"};return t.unique_pairs=[["execution_id",e.id]],t.update_pairs=[["action_type",e.action_type],["api_time",e.api_time],["heavy_processing_time",e.heavy_processing_time],["total_time",e.total_time],["report",e.report.substring(0,199)],["debug_string",e.debug_string.substring(0,1999)]],insertOrUpdate(t)}function getConfigValue(e){var t=new GlideRecord("x_fmcna_armis_inte_armis_integration_configuration");return t.addQuery("key",e),t.query(),0==t.getRowCount()?"":(t.next(),t.getValue("value"))}function getCacheValue(e,t){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");if(r.addQuery("key",e),r.query(),0==r.getRowCount())return null;switch(r.next(),t){case"str":return r.getValue("value_string");case"int":return r.getValue("value_int");case"datetime":return r.getValue("value_datetime")}}function getCurrentToken(){return getCacheValue("token","str")}function setCacheValue(e,t,r){var a={table:"x_fmcna_armis_inte_armis_integration_cache"};switch(a.unique_pairs=[["key",e]],r){case"str":a.update_pairs=[["value_string",t]];break;case"int":a.update_pairs=[["value_int",t]];break;case"datetime":a.update_pairs=[["value_datetime",t]]}return insertOrUpdate(a)}function deleteCacheValue(e){var t=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");t.addQuery("key",e),t.query(),t.deleteMultiple()}


// ACTION SPECIFIC FUNCTIONS

// CSV encapsulation as per RFC4180. Note that Armis is a bit finicky so I'm just encapsulating and not checking whether I have to.
function csv_encapsulate(str) { return '"' + str.replace('"','""') + '"' }

(function execute(inputs, outputs) {
  
  //Init
  var debug = []
  var start_time = now()
  var api_total = 0 // total time spent on the api
  var heavy_total = 0 // total time spent on sql processing
  var query_limit = 2 //This is how many properties should be processed at once--for each of the operations below, Armis can sustain 2000 at once.
  
  //Setting these up for easy reference/manipulation
  var ops = [
    { name: 'arp',
      table: 'x_fmcna_armis_inte_armis_op_arp_table' },
    { name: 'key_attributes',
      table: 'x_fmcna_armis_inte_armis_op_key_attribute' },
    { name: 'properties',
      table: 'x_fmcna_armis_inte_armis_op_property_upload' },
    { name: 'applications',
      table: 'x_fmcna_armis_inte_armis_op_application_upload' }
  ]
  
  
  //First, count how many sets of operations we'll need for each.
  debug.push("COUNT OPERATIONS")
  for(var i=0;i&lt;ops.length;i++)
  {
    var agg = new GlideAggregate(ops[i].table)
    agg.addAggregate('COUNT', 'status')
    agg.addQuery('status','PENDING')
    
    var heavy_ms = now()
    agg.query()
    heavy_ms = now() - heavy_ms
    heavy_total += heavy_ms
    
    while(agg.next())
    {
      var count = agg.getAggregate('COUNT','status')
      ops[i].num_loops_to_do = Math.ceil(count/query_limit)
      ops[i].count = count
      debug.push( "Operation " + ops[i].name + " count: " + ops[i].count + " (" + ops[i].count + " loops, " + heavy_ms + "ms)" )
    }
  }
  
  //EXECUTE THE LOOP.
  // We end when we're out of time OR if we've flagged for an early exit.
  var end_loop_early = false
  var oi = 0 // "operation index"
  var operation_loop_count = 0
  while(!end_loop_early &amp;&amp; now() - start_time &lt; inputs.max_seconds*1000)
  {
    //Counting the number of loops done for this option within the ops array
    if(ops[oi].num_loops_done == null) { ops[oi].num_loops_done = 0 }
    debug.push("PERFORMING OPERATION '" + ops[oi].name + "', iteration " + (ops[oi].num_loops_done + 1) + "/" + ops[oi].num_loops_to_do)
    
    //EXECUTE API REQUEST
    var q = new GlideRecord(ops[oi].table)
    q.addQuery('status','PENDING')
    q.setLimit(query_limit)
    
    var heavy_ms = now()
    q.query()
    heavy_ms = now() - heavy_ms
    heavy_total += heavy_ms
    debug.push("    Retrieved " + q.getRowCount() + " records. (" + heavy_ms + "ms)")
    
    //Prep the payload that will be sent as an attachment or as the body of a query.
    var payload
    switch (ops[oi].name)
    {
      case 'arp': payload = ['mac,ip'];break;
      case 'key_attributes': payload = ['id,mac,key,value'];break;
      case 'properties':
      case 'applications':
        payload = []    
    }
    
    while(q.next())
    {
      //Behavior depends on which operation
      switch (ops[oi].name)
      {
        case 'arp':
          payload.push(q.mac + ',' + q.ip);break;
        case 'key_attributes':
          var id=0; if(q.armis_device_id != null) { id = q.armis_device_id }
          var mac=""; if(q.armis_mac != null) { mac = q.armis_mac }
          payload.push(id + "," + mac + "," + q.
                       
                       
                       
                       /////////////////////////////BREAKING FOR WORK, 7/24//////////////////////////////
                       
                       
                       
                       
      }
    }
    
    //Done with this operation, iterate it.
    ops[oi].num_loops_done++
    //Are we done with all loops for this operation?
    if(ops[oi].num_loops_done &gt;= ops[oi].num_loops_to_do)
    {
      debug.push("Completed all operations for '" + ops[oi].name + "'.")
      oi++
      if(oi &gt;= ops.length) { end_loop_early = true }
    }
    
  }
  
  debug.push("FINAL INFO ARRAY: " + JSON.stringify(ops))
  outputs.debug = debug.join('\n')
})(inputs, outputs);
</value>
        <variable display_value="">71aa7f6647032200b4fad7527c9a719b</variable>
    </sys_variable_value>
    <sys_element_mapping action="delete_multiple" query="id=67123b081b1a9c104ca7edf9bc4bcb17"/>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>application</field>
        <id>67123b081b1a9c104ca7edf9bc4bcb17</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:43</sys_created_on>
        <sys_id>ef123b081b1a9c104ca7edf9bc4bcb24</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 21:08:43</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>max_seconds</field>
        <id>67123b081b1a9c104ca7edf9bc4bcb17</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 22:29:46</sys_created_on>
        <sys_id>72a488101b9a9c104ca7edf9bc4bcb1e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 22:29:46</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_67123b081b1a9c104ca7edf9bc4bcb17</table>
        <value>{{action.max_seconds}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>script</field>
        <id>67123b081b1a9c104ca7edf9bc4bcb17</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:43</sys_created_on>
        <sys_id>a3123b081b1a9c104ca7edf9bc4bcb25</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 21:08:43</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_hub_step_ext_input action="delete_multiple" query="model=67123b081b1a9c104ca7edf9bc4bcb17^sys_idNOT INbea488101b9a9c104ca7edf9bc4bcb05"/>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>max_seconds</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label/>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">67123b081b1a9c104ca7edf9bc4bcb17</model>
        <model_id>67123b081b1a9c104ca7edf9bc4bcb17</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_67123b081b1a9c104ca7edf9bc4bcb17</name>
        <next_element/>
        <order>0</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 22:29:46</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>bea488101b9a9c104ca7edf9bc4bcb05</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 22:29:46</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_output action="delete_multiple" query="model=67123b081b1a9c104ca7edf9bc4bcb17^sys_idNOT IN23123b081b1a9c104ca7edf9bc4bcb1c"/>
    <sys_hub_step_ext_output action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string,uiTypeLabel=String,uiUniqueId=43d13408-838c-41e3-bd14-36ff6a8d5360</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>debug</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>debug</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">67123b081b1a9c104ca7edf9bc4bcb17</model>
        <model_id>67123b081b1a9c104ca7edf9bc4bcb17</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_output_67123b081b1a9c104ca7edf9bc4bcb17</name>
        <next_element/>
        <order>1</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_output</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:42</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>23123b081b1a9c104ca7edf9bc4bcb1c</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 21:08:42</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_output>
    <sys_hub_action_input action="delete_multiple" query="model=2f83678c1b969c104ca7edf9bc4bcb28^sys_idNOT INe71273401b1a9c104ca7edf9bc4bcb9c"/>
    <sys_hub_action_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=integer,uiTypeLabel=Integer,uiUniqueId=9dd34c62-d723-4356-892b-72c8373f376e</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value>30</default_value>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>max_seconds</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="Integer">integer</internal_type>
        <label>max_seconds</label>
        <mandatory>false</mandatory>
        <max_length>40</max_length>
        <model display_value="UP_UploadBatches (v2.1)">2f83678c1b969c104ca7edf9bc4bcb28</model>
        <model_id>2f83678c1b969c104ca7edf9bc4bcb28</model_id>
        <model_table>sys_hub_action_type_definition</model_table>
        <name>var__m_sys_hub_action_input_2f83678c1b969c104ca7edf9bc4bcb28</name>
        <next_element/>
        <order>1</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_action_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:42</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>e71273401b1a9c104ca7edf9bc4bcb9c</sys_id>
        <sys_mod_count>1</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 22:29:45</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_action_input>
    <sys_hub_step_instance action="delete_multiple" query="action=2f83678c1b969c104ca7edf9bc4bcb28^sys_idNOT IN67123b081b1a9c104ca7edf9bc4bcb17"/>
    <sys_hub_step_instance action="INSERT_OR_UPDATE">
        <action display_value="UP_UploadBatches (v2.1)">2f83678c1b969c104ca7edf9bc4bcb28</action>
        <cid>9c44111f-3494-4908-9eca-f8468b3064d0</cid>
        <extended_inputs/>
        <extended_inputs/>
        <extended_outputs/>
        <icon/>
        <inputs/>
        <label>Script step</label>
        <order>1</order>
        <outputs/>
        <section/>
        <step_type display_value="Script">106afb6647032200b4fad7527c9a71e7</step_type>
        <sys_class_name>sys_hub_step_instance</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:42</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>67123b081b1a9c104ca7edf9bc4bcb17</sys_id>
        <sys_mod_count>13</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 23:23:12</sys_updated_on>
    </sys_hub_step_instance>
    <sys_variable_value action="delete_multiple" query="document_key=67123b081b1a9c104ca7edf9bc4bcb17"/>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>67123b081b1a9c104ca7edf9bc4bcb17</document_key>
        <order>400</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:43</sys_created_on>
        <sys_id>27123b081b1a9c104ca7edf9bc4bcb25</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 21:08:43</sys_updated_on>
        <value>35aa573fd7802200bdbaee5b5e610375</value>
        <variable display_value="">f5e56d79b3101300176b051a16a8dce4</variable>
    </sys_variable_value>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>67123b081b1a9c104ca7edf9bc4bcb17</document_key>
        <order>600</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:43</sys_created_on>
        <sys_id>e7123b081b1a9c104ca7edf9bc4bcb25</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 23:23:12</sys_updated_on>
        <value>/* 

This function uploads batches from the ARP, Key Attribute, Property, and Application tables. (In that order.)

For each operation:
1. Pull up to 2000 records and set their status to PROCESSING.
2. Compose a JSON payload or a CSV attachment with the contents.
3. Execute the REST API call and document the results. If it succeeds, set all 1000 records to COMPLETED, otherwise reset them to PENDING.

Operations should be done precisely in the order of ARP, then Key Attribute, then Property, then Application. However, because more ARPs may come in while the last stack of ARPs is processing, snapshots of the counts of each will be taken at the beginning to ensure that the system doesn't get bogged down doing a handful of ARPs over and over and nothing else.

*/

//FUNCTION LIBRARY (v0.4) -- THESE FUNCTIONS HAVE BEEN MINIFIED.
//FOR FULL DOCUMENTAITON AND A CURRENT COPY, SEE THE ACTION "(vX.X) FUNCTION_LIBRARY"
function now(){return(new GlideDateTime).getNumericValue()}function includes(e,t){for(var r=0;r&lt;e.length;r++)if(e[r]==t)return!0;return!1}function digest(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return t&gt;&gt;&gt;0}function generateID(){var e="";arr="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var t=6;t&gt;0;t--)e+=arr[Math.floor(Math.random()*arr.length)];return e}function insertOrUpdate(e){var t={},r=now();null==e.unique_pairs&amp;&amp;(e.unique_pairs=[]);try{var a=new GlideRecord(e.table);if(0!=e.unique_pairs.length){for(var i=0;i&lt;e.unique_pairs.length;i++)a.addQuery(e.unique_pairs[i][0],e.unique_pairs[i][1]);a.query()}if(0==a.getRowCount()){a.initialize();for(i=0;i&lt;e.unique_pairs.length;i++)a[e.unique_pairs[i][0]]=e.unique_pairs[i][1];for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.insert(),t.operation="insert"}else{for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.updateMultiple(),t.operation="update"}}catch(e){t.operation="error: "+e}return t.time_delta=now()-r,t}function writeToAPILog(e){null==e.payload&amp;&amp;(e.payload=""),null==e.response_body&amp;&amp;(e.response_body="");var t={table:"x_fmcna_armis_inte_armis_rest_api_log"};return t.update_pairs=[["execution_id",e.id],["api_endpoint",e.endpoint],["payload",e.payload.substring(0,1999)],["response_code",e.response_code],["response_body",e.response_body.substring(0,1999)],["query_submitted_at",e.start_time],["query_response_time_ms",e.time_delta_ms]],insertOrUpdate(t)}function queueProperty(e){if(null==e.name||""==e.name)return{operation:"error: empty name",time_delta:0};if(null==e.value||""==e.value)return{operation:"error: empty value",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_property_upload"};return t.update_pairs=[["armis_device_id",e.armis_id],["property_name",e.name],["property_value",e.value],["execution_id",e.execution_id],["status","PENDING"]],insertOrUpdate(t)}function queueARP(e){if(null==e.mac||""==e.mac)return{operation:"error: empty mac",time_delta:0};if(null==e.ip||""==e.ip)return{operation:"error: empty ip",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_arp_table"};return t.update_pairs=[["execution_id",e.execution_id],["mac",e.mac],["ip",e.ip],["status","PENDING"]],insertOrUpdate(t)}function queueKeyAttribute(e){if(!(null!=e.armis_id&amp;&amp;""!=e.armis_id||null!=e.mac&amp;&amp;""!=e.mac))return{operation:"error: must have either a MAC or an Armis ID",time_delta:0};if(allowed_attributes=["CATEGORY","IP","LAST_SEEN","MODEL","NAME","OS","OS_VERSION","TAG","TYPE","USER"],0==includes(allowed_attributes,e.attribute))return{operation:"error: attribute '"+e.attribute+"' is not valid.",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_key_attribute"};return t.update_pairs=[["execution_id",e.execution_id],["armis_device_id",e.mac],["armis_mac",e.mac],["attribute",e.attribute],["value",e.value],["status","PENDING"]],insertOrUpdate(t)}function queueApplication(e){if(null==e.armis_id||""==e.armis_id)return{operation:"error: Armis ID cannot be empty",time_delta:0};if(null==e.name||""==e.name)return{operation:"error: Software name cannot be empty",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_application_upload"};return t.update_pairs=[["execution_id",e.execution_id],["armis_device_id",e.mac],["application_name",e.name],["application_version",e.version],["status","PENDING"]],insertOrUpdate(t)}function writeToActionLog(e){var t={table:"x_fmcna_armis_inte_armis_action_log"};return t.unique_pairs=[["execution_id",e.id]],t.update_pairs=[["action_type",e.action_type],["api_time",e.api_time],["heavy_processing_time",e.heavy_processing_time],["total_time",e.total_time],["report",e.report.substring(0,199)],["debug_string",e.debug_string.substring(0,1999)]],insertOrUpdate(t)}function getConfigValue(e){var t=new GlideRecord("x_fmcna_armis_inte_armis_integration_configuration");return t.addQuery("key",e),t.query(),0==t.getRowCount()?"":(t.next(),t.getValue("value"))}function getCacheValue(e,t){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");if(r.addQuery("key",e),r.query(),0==r.getRowCount())return null;switch(r.next(),t){case"str":return r.getValue("value_string");case"int":return r.getValue("value_int");case"datetime":return r.getValue("value_datetime")}}function getCurrentToken(){return getCacheValue("token","str")}function setCacheValue(e,t,r){var a={table:"x_fmcna_armis_inte_armis_integration_cache"};switch(a.unique_pairs=[["key",e]],r){case"str":a.update_pairs=[["value_string",t]];break;case"int":a.update_pairs=[["value_int",t]];break;case"datetime":a.update_pairs=[["value_datetime",t]]}return insertOrUpdate(a)}function deleteCacheValue(e){var t=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");t.addQuery("key",e),t.query(),t.deleteMultiple()}


// ACTION SPECIFIC FUNCTIONS

// CSV encapsulation as per RFC4180. Note that Armis is a bit finicky so I'm just encapsulating and not checking whether I have to.
function csv_encapsulate(str) { return '"' + str.replace('"','""') + '"' }

(function execute(inputs, outputs) {
  
  //Init
  var debug = []
  var start_time = now()
  var api_total = 0 // total time spent on the api
  var heavy_total = 0 // total time spent on sql processing
  var query_limit = 2 //This is how many properties should be processed at once--for each of the operations below, Armis can sustain 2000 at once.
  
  //Setting these up for easy reference/manipulation
  var ops = [
    { name: 'arp',
      table: 'x_fmcna_armis_inte_armis_op_arp_table' },
    { name: 'key_attributes',
      table: 'x_fmcna_armis_inte_armis_op_key_attribute' },
    { name: 'properties',
      table: 'x_fmcna_armis_inte_armis_op_property_upload' },
    { name: 'applications',
      table: 'x_fmcna_armis_inte_armis_op_application_upload' }
  ]
  
  
  //First, count how many sets of operations we'll need for each.
  debug.push("COUNT OPERATIONS")
  for(var i=0;i&lt;ops.length;i++)
  {
    var agg = new GlideAggregate(ops[i].table)
    agg.addAggregate('COUNT', 'status')
    agg.addQuery('status','PENDING')
    
    var heavy_ms = now()
    agg.query()
    heavy_ms = now() - heavy_ms
    heavy_total += heavy_ms
    
    while(agg.next())
    {
      var count = agg.getAggregate('COUNT','status')
      ops[i].num_loops_to_do = Math.ceil(count/query_limit)
      ops[i].count = count
      debug.push( "Operation " + ops[i].name + " count: " + ops[i].count + " (" + ops[i].count + " loops, " + heavy_ms + "ms)" )
    }
  }
  
  //EXECUTE THE LOOP.
  // We end when we're out of time OR if we've flagged for an early exit.
  var end_loop_early = false
  var oi = 0 // "operation index"
  var operation_loop_count = 0
  while(!end_loop_early &amp;&amp; now() - start_time &lt; inputs.max_seconds*1000)
  {
    //Counting the number of loops done for this option within the ops array
    if(ops[oi].num_loops_done == null) { ops[oi].num_loops_done = 0 }
    debug.push("PERFORMING OPERATION '" + ops[oi].name + "', iteration " + (ops[oi].num_loops_done + 1) + "/" + ops[oi].num_loops_to_do)
    
    //EXECUTE API REQUEST
    var q = new GlideRecord(ops[oi].table)
    q.addQuery('status','PENDING')
    q.setLimit(query_limit)
    
    var heavy_ms = now()
    q.query()
    heavy_ms = now() - heavy_ms
    heavy_total += heavy_ms
    debug.push("    Retrieved " + q.getRowCount() + " records. (" + heavy_ms + "ms)")
    
    //Prep the payload that will be sent as an attachment or as the body of a query.
    var payload
    switch (ops[oi].name)
    {
      case 'arp': payload = ['mac,ip'];break;
      case 'key_attributes': payload = ['id,mac,key,value'];break;
      case 'properties':
      case 'applications':
        payload = []    
    }
    
    while(q.next())
    {
      //Behavior depends on which operation
      switch (ops[oi].name)
      {
        case 'arp':
          payload.push(q.mac + ',' + q.ip);break;
        case 'key_attributes':
          var id=0; if(q.armis_device_id != null) { id = q.armis_device_id }
          var mac=""; if(q.armis_mac != null) { mac = q.armis_mac }
          payload.push(id + "," + mac + "," + q.
                       
                       
                       
                       /////////////////////////////BREAKING FOR WORK, 7/24//////////////////////////////
                       
                       
                       
                       
      }
    }
    
    //Done with this operation, iterate it.
    ops[oi].num_loops_done++
    //Are we done with all loops for this operation?
    if(ops[oi].num_loops_done &gt;= ops[oi].num_loops_to_do)
    {
      debug.push("Completed all operations for '" + ops[oi].name + "'.")
      oi++
      if(oi &gt;= ops.length) { end_loop_early = true }
    }
    
  }
  
  debug.push("FINAL INFO ARRAY: " + JSON.stringify(ops))
  outputs.debug = debug.join('\n')
})(inputs, outputs);
</value>
        <variable display_value="">71aa7f6647032200b4fad7527c9a719b</variable>
    </sys_variable_value>
    <sys_element_mapping action="delete_multiple" query="id=67123b081b1a9c104ca7edf9bc4bcb17"/>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>application</field>
        <id>67123b081b1a9c104ca7edf9bc4bcb17</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:43</sys_created_on>
        <sys_id>ef123b081b1a9c104ca7edf9bc4bcb24</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 21:08:43</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>max_seconds</field>
        <id>67123b081b1a9c104ca7edf9bc4bcb17</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 22:29:46</sys_created_on>
        <sys_id>72a488101b9a9c104ca7edf9bc4bcb1e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 22:29:46</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_67123b081b1a9c104ca7edf9bc4bcb17</table>
        <value>{{action.max_seconds}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>script</field>
        <id>67123b081b1a9c104ca7edf9bc4bcb17</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:43</sys_created_on>
        <sys_id>a3123b081b1a9c104ca7edf9bc4bcb25</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 21:08:43</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_hub_step_ext_input action="delete_multiple" query="model=67123b081b1a9c104ca7edf9bc4bcb17^sys_idNOT INbea488101b9a9c104ca7edf9bc4bcb05"/>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>max_seconds</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label/>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">67123b081b1a9c104ca7edf9bc4bcb17</model>
        <model_id>67123b081b1a9c104ca7edf9bc4bcb17</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_67123b081b1a9c104ca7edf9bc4bcb17</name>
        <next_element/>
        <order>0</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 22:29:46</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>bea488101b9a9c104ca7edf9bc4bcb05</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 22:29:46</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_output action="delete_multiple" query="model=67123b081b1a9c104ca7edf9bc4bcb17^sys_idNOT IN23123b081b1a9c104ca7edf9bc4bcb1c"/>
    <sys_hub_step_ext_output action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string,uiTypeLabel=String,uiUniqueId=43d13408-838c-41e3-bd14-36ff6a8d5360</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>debug</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>debug</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">67123b081b1a9c104ca7edf9bc4bcb17</model>
        <model_id>67123b081b1a9c104ca7edf9bc4bcb17</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_output_67123b081b1a9c104ca7edf9bc4bcb17</name>
        <next_element/>
        <order>1</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_output</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:42</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>23123b081b1a9c104ca7edf9bc4bcb1c</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 21:08:42</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_output>
    <sys_documentation action="delete_multiple" query="name=var__m_sys_hub_action_input_2f83678c1b969c104ca7edf9bc4bcb28^sys_idNOT INaf123b081b1a9c104ca7edf9bc4bcb14"/>
    <sys_documentation action="INSERT_OR_UPDATE">
        <element>max_seconds</element>
        <help/>
        <hint/>
        <label>max_seconds</label>
        <language>en</language>
        <name>var__m_sys_hub_action_input_2f83678c1b969c104ca7edf9bc4bcb28</name>
        <plural/>
        <sys_class_name>sys_documentation</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-24 21:08:42</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>af123b081b1a9c104ca7edf9bc4bcb14</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package display_value="Armis Integration" source="x_fmcna_armis_inte">7574b5e3dbf4d050cb24431e13961986</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-24 21:08:42</sys_updated_on>
        <url/>
        <url_target/>
    </sys_documentation>
</record_update>
