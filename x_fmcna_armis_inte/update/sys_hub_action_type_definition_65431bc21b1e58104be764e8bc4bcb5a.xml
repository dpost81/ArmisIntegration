<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_hub_action_type_definition">
    <sys_hub_action_type_definition action="INSERT_OR_UPDATE">
        <access>public</access>
        <acls/>
        <action_template/>
        <active>true</active>
        <annotation/>
        <callable_by_client_api>false</callable_by_client_api>
        <category/>
        <copied_from/>
        <copied_from_name/>
        <description/>
        <ih_action>false</ih_action>
        <internal_name>update_processupdate_v21</internal_name>
        <label_cache>[{"name":"{{action.fields}}","label":"action➛fields","type":"action","ref":""},{"name":"{{action.computer}}","label":"action➛computer","type":"action","ref":""},{"name":"{{action.computer_sys_id}}","label":"action➛computer_sys_id","type":"action","ref":""},{"name":"{{step[32ab521e-c2c5-4424-8abd-c8997be99e74].variable}}","label":"step➛Script step➛variable","type":"step","ref":""},{"name":"{{step[32ab521e-c2c5-4424-8abd-c8997be99e74].debug}}","label":"step➛Script step➛debug","type":"step","ref":""}]</label_cache>
        <latest_snapshot>71c6508c1b2610104ca7edf9bc4bcb1a</latest_snapshot>
        <master_snapshot>8344bb0a1bde58104be764e8bc4bcbee</master_snapshot>
        <name>UPDATE_ProcessUpdate (v2.1)</name>
        <natlang/>
        <outputs/>
        <state>published</state>
        <sys_class_name>sys_hub_action_type_definition</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:01:48</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_domain>global</sys_domain>
        <sys_id>65431bc21b1e58104be764e8bc4bcb5a</sys_id>
        <sys_mod_count>57</sys_mod_count>
        <sys_name>UPDATE_ProcessUpdate (v2.1)</sys_name>
        <sys_overrides/>
        <sys_package display_value="Armis Integration" source="x_fmcna_armis_inte">7574b5e3dbf4d050cb24431e13961986</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name>sys_hub_action_type_definition_65431bc21b1e58104be764e8bc4bcb5a</sys_update_name>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:07</sys_updated_on>
        <system_level>false</system_level>
        <type/>
    </sys_hub_action_type_definition>
    <sys_variable_value action="delete_multiple" query="document_key=65431bc21b1e58104be764e8bc4bcb5a"/>
    <sys_hub_step_instance action="delete_multiple" query="action=65431bc21b1e58104be764e8bc4bcb5a^sys_idNOT IN837b53421b5e58104be764e8bc4bcbb3"/>
    <sys_hub_step_instance action="INSERT_OR_UPDATE">
        <action display_value="UPDATE_ProcessUpdate (v2.1)">65431bc21b1e58104be764e8bc4bcb5a</action>
        <cid>32ab521e-c2c5-4424-8abd-c8997be99e74</cid>
        <extended_inputs/>
        <extended_inputs/>
        <extended_outputs/>
        <icon/>
        <inputs/>
        <label>Script step</label>
        <order>1</order>
        <outputs/>
        <section/>
        <step_type display_value="Script">106afb6647032200b4fad7527c9a71e7</step_type>
        <sys_class_name>sys_hub_step_instance</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:40</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>837b53421b5e58104be764e8bc4bcbb3</sys_id>
        <sys_mod_count>15</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:05</sys_updated_on>
    </sys_hub_step_instance>
    <sys_variable_value action="delete_multiple" query="document_key=837b53421b5e58104be764e8bc4bcbb3"/>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>837b53421b5e58104be764e8bc4bcbb3</document_key>
        <order>400</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>4f7b53421b5e58104be764e8bc4bcbc6</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <value>35aa573fd7802200bdbaee5b5e610375</value>
        <variable display_value="">f5e56d79b3101300176b051a16a8dce4</variable>
    </sys_variable_value>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>837b53421b5e58104be764e8bc4bcbb3</document_key>
        <order>600</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>877b53421b5e58104be764e8bc4bcbc7</sys_id>
        <sys_mod_count>14</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:05</sys_updated_on>
        <value>/*

This should be called every time a computer gets an update.

This script does the following:
1. Determine whether we have a currently linked device.
   If no, queue up a novel device link attempt.
   If yes, continue.
2. Iterate through all fields that have been updated. For each field, queue the appropriate item into the appropriate operation queue (prop,att).
3. If any fields updated, queue an arp entry as well.

*/
//x_fmcna_armis_inte_armis_snow_novel_link_queue

//GENERAL FUNCTION LIBRARY v0.9 MINIFIED
//SEE FUNCTION_LIBRARY ACTION FOR DOCUMENTATION AND FULL VERSION
function now(){return(new GlideDateTime).getNumericValue()}function lapReport(e){var r="("+(now()-e)+"ms)";return e=now(),r}function includes(e,r){for(var t=0;t&lt;e.length;t++)if(e[t]==r)return!0;return!1}function digest(e){for(var r=5381,t=e.length;t;)r=33*r^e.charCodeAt(--t);return r&gt;&gt;&gt;0}function isValidIPAddress(e){return!!RegExp("^([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])$").test(e)||!!RegExp("^((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*::((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*|((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4})){7}$").test(e)}function isValidMACAddress(e){return RegExp("^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})|([0-9a-fA-F]{4}\\.[0-9a-fA-F]{4}\\.[0-9a-fA-F]{4})$").test(e)}function generateID(){var e="";arr="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var r=6;r&gt;0;r--)e+=arr[Math.floor(Math.random()*arr.length)];return e}function insertOrUpdate(e){var r={},t=now();null==e.unique_pairs&amp;&amp;(e.unique_pairs=[]);try{var a=new GlideRecord(e.table);if(0!=e.unique_pairs.length){for(var i=0;i&lt;e.unique_pairs.length;i++)a.addQuery(e.unique_pairs[i][0],e.unique_pairs[i][1]);a.query()}if(0==a.getRowCount()){a.initialize();for(i=0;i&lt;e.unique_pairs.length;i++)a[e.unique_pairs[i][0]]=e.unique_pairs[i][1];for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.insert(),r.operation="insert"}else{for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.updateMultiple(),r.operation="update"}}catch(e){r.operation="error: "+e}return r.time_delta=now()-t,r}function writeToActionLog(e){var r={table:"x_fmcna_armis_inte_armis_action_log"};return r.unique_pairs=[["execution_id",e.id]],r.update_pairs=[["action_type",e.action_type],["api_time",e.api_time],["heavy_processing_time",e.heavy_processing_time],["total_time",e.total_time],["report",(""+e.report).substring(0,199)],["debug_string",(""+e.debug_string).substring(0,1999)]],insertOrUpdate(r)}function writeToErrorLog(e){var r={table:"x_fmcna_armis_inte_armis_error_log"};return r.unique_pairs=[["execution_id",e.id]],r.update_pairs=[["error_message",e.error_message],["debug_string",e.debug_string]],insertOrUpdate(r)}function getConfigValue(e){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_configuration");return r.addQuery("key",e),r.query(),0==r.getRowCount()?"":(r.next(),r.getValue("value"))}function getCacheValue(e,r){var t=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");if(t.addQuery("key",e),t.query(),0==t.getRowCount())return null;switch(t.next(),r){case"str":return t.getValue("value_string");case"int":return t.getValue("value_int");case"datetime":return t.getValue("value_datetime")}}function getCurrentToken(){return getCacheValue("token","str")}function setCacheValue(e,r,t){var a={table:"x_fmcna_armis_inte_armis_integration_cache"};switch(a.unique_pairs=[["key",e]],t){case"str":a.update_pairs=[["value_string",r]];break;case"int":a.update_pairs=[["value_int",r]];break;case"datetime":a.update_pairs=[["value_datetime",r]]}return insertOrUpdate(a)}function deleteCacheValue(e){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");r.addQuery("key",e),r.query(),r.deleteMultiple()}


//'TABLES AND REST' FUNCTION LIBRARY v0.13 MINIFIED
//SEE FUNCTION_LIBRARY ACTION FOR DOCUMENTATION AND FULL VERSION
function writeToAPILog(e){null==e.payload&amp;&amp;(e.payload=""),null==e.response_body&amp;&amp;(e.response_body="");var t={table:"x_fmcna_armis_inte_armis_rest_api_log"};return t.update_pairs=[["execution_id",e.id],["api_endpoint",e.endpoint],["payload",(""+e.payload).substring(0,1999)],["response_code",e.response_code],["response_body",(""+e.response_body).substring(0,1999)],["query_submitted_at",e.start_time],["query_response_time_ms",e.time_delta_ms]],insertOrUpdate(t)}function queueProperty(e){if(null==e.name||""==e.name)return{operation:"error: empty name",time_delta:0};if(null==e.value||""==e.value)return{operation:"error: empty value",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_property_upload"};return t.unique_pairs=[["armis_device_id",e.armis_id],["property_name",e.name]],t.update_pairs=[["property_value",e.value],["execution_id",e.execution_id],["status","PENDING"]],insertOrUpdate(t)}function queueARP(e){if(null==e.mac||""==e.mac)return{operation:"error: empty mac",time_delta:0};if(null==e.ip||""==e.ip)return{operation:"error: empty ip",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_arp_table"};return t.update_pairs=[["execution_id",e.execution_id],["mac",e.mac],["ip",e.ip],["status","PENDING"]],insertOrUpdate(t)}function queueKeyAttribute(e){if(!(null!=e.armis_id&amp;&amp;""!=e.armis_id||null!=e.mac&amp;&amp;""!=e.mac))return{operation:"error: must have either a MAC or an Armis ID",time_delta:0};if(allowed_attributes=["CATEGORY","IP","LAST_SEEN","MODEL","NAME","OS","OS_VERSION","TAG","TYPE","USER"],0==includes(allowed_attributes,e.attribute))return{operation:"error: attribute '"+e.attribute+"' is not valid.",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_key_attribute"};return t.unique_pairs=[["armis_mac",e.mac],["attribute",e.attribute]],t.update_pairs=[["execution_id",e.execution_id],["armis_device_id",e.armis_id],["value",e.value],["status","PENDING"]],insertOrUpdate(t)}function queueApplication(e){if(null==e.armis_id||""==e.armis_id)return{operation:"error: Armis ID cannot be empty",time_delta:0};if(null==e.name||""==e.name)return{operation:"error: Software name cannot be empty",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_application_upload"};return t.unique_pairs=[["armis_device_id",e.armis_id],["application_name",e.name]],t.update_pairs=[["execution_id",e.execution_id],["application_version",e.version],["status","PENDING"]],insertOrUpdate(t)}function executeStandardREST(e){try{var t=new GlideDateTime,i=new sn_ws.RESTMessageV2("Armis API",e.endpoint);i.setRequestHeader("Authorization",getCurrentToken()),i.setRequestHeader("accept","application/json"),i.setRequestHeader("content-type","application/json"),null==e.query_params&amp;&amp;(e.query_params=[]);for(var a=0;a&lt;e.query_params.length;a++)i.setQueryParameter(e.query_params[a][0],e.query_params[a][1]);i.setRequestBody(e.payload);var r,n=now(),s={};return 1==e.async?r=i.executeAsync():(r=i.execute(),s.response_code=r.getStatusCode(),s.response_body=r.getBody()),s.api_time=now()-n,writeToAPILog({id:e.id,endpoint:e.endpoint,payload:e.payload,response_code:s.response_code,response_body:s.response_body,start_time:t,time_delta_ms:s.api_time}),s}catch(e){return(s={response_code:"xx"}).response_body="Failed to build query. "+e,s.api_time=0,s}}function queueAttachmentREST(e){var t=new GlideRecord("sys_attachment"),i=(new GlideSysAttachment).write(t,e.id+".csv","text/plain",e.payload),a=new GlideRecord("x_fmcna_armis_inte_armis_attachment_upload");a.initialize(),a.attachment=i,a.execution_id=e.id,a.status="PENDING",a.type=e.type,a.content=e.payload,a.insert()}function getBestMAC(e){if(isValidMACAddress(e.mac_address)&amp;&amp;!e.mac_address.endsWith("00:00:01"))return e.mac_address;var t=new GlideRecord("cmdb_ci_network_adapter");t.addQuery("cmdb_ci",e.sys_id),t.query();for(var i=null,a=-1e3;t.next();)if(isValidMACAddress(t.mac_address)&amp;&amp;!t.mac_address.endsWith("00:00:01")){var r=0;t.ip_address.startsWith("10.")&amp;&amp;(r+=1e3),t.name.startsWith("Local Area")&amp;&amp;(r+=900);var n=new GlideAggregate("cmdb_ci_network_adapter");n.addAggregate("COUNT"),n.addQuery("mac_address",t.mac_address),n.query(),n.next()&amp;&amp;(r-=n.getAggregate("COUNT")),r&gt;a&amp;&amp;r&gt;0&amp;&amp;(i=""+t.mac_address,a=r)}return i}function queueInitialARPandCSV(e,t){var i=getBestMAC(e),a=e.ip_address;isValidMACAddress(i)&amp;&amp;isValidIPAddress(a)&amp;&amp;(queueARP({execution_id:t,mac:i,ip:a}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"NAME",value:""+e.name}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"IP",value:a}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"TAG",value:getConfigValue("armis_import_universal_tag")}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"LAST_SEEN",value:(new GlideDateTime).getDisplayValue().replace(" ","T")}),null!=e.model_id&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"MODEL",value:e.model_id.getDisplayValue()}),null!=e.os&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"OS",value:e.os.getDisplayValue()}),null!=e.os_version&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"OS_VERSION",value:e.os_version}),null!=e.users&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"USER",value:e.users}))}function getPendingRecordsEndSysID(e,t,i){null==i&amp;&amp;(i={}),null==i.force_field&amp;&amp;(i.force_field="status"),null==i.force_pending&amp;&amp;(i.force_pending="PENDING");var a=new GlideRecord(t);for(a.addQuery(i.force_field,i.force_pending),a.setLimit(e),a.orderBy("sys_id"),a.query();a.next();)if(0==a.hasNext())return a.getValue("sys_id");return null}function getNumPendingRecords(e,t,i,a){null==a&amp;&amp;(a={}),null==a.force_field&amp;&amp;(a.force_field="status"),null==a.force_pending&amp;&amp;(a.force_pending="PENDING");var r=new GlideRecord(t);return r.addQuery(a.force_field,a.force_pending),r.setLimit(e),r.orderBy("sys_id"),r.addQuery("sys_id","&lt;=",i),r.query(),r}






(function execute(inputs, outputs) {
 
  var start_time = now()
  var eid = generateID()
  var lap = now()
  var error_report = ''
  var report_string = ''
  var num_properties = 0
  var debug = ['BEGIN DEVICE ' + inputs.computer_sys_id]
  
  
  try 
  {
    //Grab the computer associated with this sys_id, kill process if none.
    //(Doing this because I've had cases where a trigger occurs on a device that doesn't end up actually existing, 'tis weird
    if(inputs.computer_sys_id == '') { return }
    var snow_device = new GlideRecord('cmdb_ci_computer')
    snow_device.addQuery('sys_id',inputs.computer_sys_id)
    snow_device.query()
    if(!snow_device.next()) { return }
    
    report_string += "Computer '" + snow_device.name + "': "

    debug.push("SNOW Device: '" + snow_device.name + "' " + lapReport(lap));lap=now()

    //STEP ONE -- DOES THIS DEVICE HAVE A LINKED ARMIS DEVICE?


    var armis_device = new GlideRecord('x_fmcna_armis_inte_armis_device_table')
    armis_device.addQuery('linked_snow_computer',inputs.computer_sys_id)
    armis_device.query()
    if(!armis_device.next())
    {
      //No Armis device. Queue a novel device link push and exit.
      debug.push("No linked Armis device. Pushing ARP and CSV. "+ lapReport(lap));lap=now()
      report_string += 'no link, pushed ARP and CSV values.'
      queueInitialARPandCSV(snow_device,eid)
      debug.push("Queued. "+ lapReport(lap));lap=now()
    }
    else
    {
      debug.push("Linked Armis device '" + armis_device.name + "'. Proceeding to update. "+ lapReport(lap));lap=now()

      //STEP TWO -- ITERATE THROUGH FIELDS, AND IF ANY MATCH, QUEUE THOSE PROPERTIES.

      //Combine property references (did multiple config fields for extensibility)
      var property_reference = getConfigValue('snow_property_reference_1') + getConfigValue('snow_property_reference_2') + getConfigValue('snow_property_reference_3')
      property_reference = property_reference.split(',')

      //Split propertes. We will end up with a dictionary of the form { field_name: 'display value'} that we will use to govern what gets sent to Armis.
      var property_dictionary = {}
      for(var i=0;i&lt;property_reference.length;i++) { var p = property_reference[i].split(':'); property_dictionary[p[0]] = p[1] }

      //Iterate through our given update fields. Note that these are an array in the form of:
      /* [{
        "previous_display_value": "internal_2008T-OS_5.0.376a",
        "previous_value": "internal_2008T-OS_5.0.376a",
        "current_display_value": "internal_2008T-OS_5.0.376",
        "current_value": "internal_2008T-OS_5.0.376",
        "field_name": "u_image"
      }] */

      for(var i=0;i&lt;inputs.fields.length;i++)
      {
        var field_name = inputs.fields[i].field_name
        if (field_name in property_dictionary)
        {
          var display_value = inputs.fields[i].current_display_value
          queueProperty({armis_id: armis_device.armis_device_id, execution_id: eid, name: property_dictionary[field_name], value: display_value})
          debug.push( field_name + ": queued property upload of value '" + display_value + "' "+ lapReport(lap));lap=now()
          num_properties++

          //Some specific field names need to be pushed as CSV uploads too.
          switch(field_name)
          {
            case 'name':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'NAME', value: display_value})
              debug.push("NAME" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'ip_address':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'IP', value: display_value})
              debug.push("IP" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'model_id':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'MODEL', value: display_value})
              debug.push("MODEL" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'os':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'OS', value: display_value})
              debug.push("OS" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'os_version':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'OS_VERSION', value: display_value})
              debug.push("OS_VERSION" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'assigned_to':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'USER', value: display_value})
              debug.push("USER" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
          }
        report_string += 'queued ' + num_properties + ' for upload.'
        }
        else
        {
          //This isn't a field we're interested in.
          debug.push( field_name + ": no upload needed "+ lapReport(lap));lap=now()
        }
      }
    }
  }
  catch(ex)
  {
    error_report = '[ERROR: ' + ex + '] '
    debug.push(error_report)
    writeToErrorLog({id: eid, error_message: ex, debug_string: debug.join('\n')})
    
  }
  
  debug = debug.join('\n')
  report_string = error_report + report_string
  outputs.debug = debug
  writeToActionLog({id: eid, action_type: 'trigger_computer_update', total_time: (now() - start_time), api_time: 0, heavy_processing_time: (now() - start_time), report: report_string, debug_string: debug})
  
})(inputs, outputs);
</value>
        <variable display_value="">71aa7f6647032200b4fad7527c9a719b</variable>
    </sys_variable_value>
    <sys_element_mapping action="delete_multiple" query="id=837b53421b5e58104be764e8bc4bcbb3"/>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>application</field>
        <id>837b53421b5e58104be764e8bc4bcbb3</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>077b53421b5e58104be764e8bc4bcbc6</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>computer_sys_id</field>
        <id>837b53421b5e58104be764e8bc4bcbb3</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>c37b53421b5e58104be764e8bc4bcbc8</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_837b53421b5e58104be764e8bc4bcbb3</table>
        <value>{{action.computer_sys_id}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>fields</field>
        <id>837b53421b5e58104be764e8bc4bcbb3</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>877b53421b5e58104be764e8bc4bcbc8</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_837b53421b5e58104be764e8bc4bcbb3</table>
        <value>{{action.fields}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>script</field>
        <id>837b53421b5e58104be764e8bc4bcbb3</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>cb7b53421b5e58104be764e8bc4bcbc6</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_hub_step_ext_input action="delete_multiple" query="model=837b53421b5e58104be764e8bc4bcbb3^sys_idNOT IN877b53421b5e58104be764e8bc4bcbb8,8f7b53421b5e58104be764e8bc4bcbbd"/>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>fields</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label/>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">837b53421b5e58104be764e8bc4bcbb3</model>
        <model_id>837b53421b5e58104be764e8bc4bcbb3</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_837b53421b5e58104be764e8bc4bcbb3</name>
        <next_element/>
        <order>0</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>877b53421b5e58104be764e8bc4bcbb8</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>computer_sys_id</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label/>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">837b53421b5e58104be764e8bc4bcbb3</model>
        <model_id>837b53421b5e58104be764e8bc4bcbb3</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_837b53421b5e58104be764e8bc4bcbb3</name>
        <next_element/>
        <order>100</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>8f7b53421b5e58104be764e8bc4bcbbd</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_output action="delete_multiple" query="model=837b53421b5e58104be764e8bc4bcbb3^sys_idNOT INf9343b0a1bde58104be764e8bc4bcb4f"/>
    <sys_hub_step_ext_output action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string,uiTypeLabel=String,uiUniqueId=312462aa-8d91-4371-bcb5-f1571b47d036</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>debug</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>debug</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">837b53421b5e58104be764e8bc4bcbb3</model>
        <model_id>837b53421b5e58104be764e8bc4bcbb3</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_output_837b53421b5e58104be764e8bc4bcbb3</name>
        <next_element/>
        <order>1</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_output</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:25:43</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>f9343b0a1bde58104be764e8bc4bcb4f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:25:43</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_output>
    <sys_hub_action_input action="delete_multiple" query="model=65431bc21b1e58104be764e8bc4bcb5a^sys_idNOT IN3a7bd7021b5e58104be764e8bc4bcb94,837b53421b5e58104be764e8bc4bcbab"/>
    <sys_hub_action_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>child_label=fields_child0,child_name=fields_child0,child_type=object,child_type_label=Object,child_uiUniqueId=75d7454c-8645-43c9-95a2-1a931a16659b,co_type_name=FD3e7bd7023e5e5810e6f73c32ee8bc591,element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=array.object,uiTypeLabel=Array.Object,uiUniqueId=e20c0e47-a3e4-4f8e-b9b7-9c10dcaf0945</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>fields</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>fields</label>
        <mandatory>false</mandatory>
        <max_length>65000</max_length>
        <model display_value="UPDATE_ProcessUpdate (v2.1)">65431bc21b1e58104be764e8bc4bcb5a</model>
        <model_id>65431bc21b1e58104be764e8bc4bcb5a</model_id>
        <model_table>sys_hub_action_type_definition</model_table>
        <name>var__m_sys_hub_action_input_65431bc21b1e58104be764e8bc4bcb5a</name>
        <next_element/>
        <order>1</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_action_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:40</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>3a7bd7021b5e58104be764e8bc4bcb94</sys_id>
        <sys_mod_count>16</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:04</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_action_input>
    <sys_hub_action_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string,uiTypeLabel=String,uiUniqueId=1a25cdfd-7779-4058-b808-6639fe96482f</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>computer_sys_id</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>computer_sys_id</label>
        <mandatory>false</mandatory>
        <max_length>8000</max_length>
        <model display_value="UPDATE_ProcessUpdate (v2.1)">65431bc21b1e58104be764e8bc4bcb5a</model>
        <model_id>65431bc21b1e58104be764e8bc4bcb5a</model_id>
        <model_table>sys_hub_action_type_definition</model_table>
        <name>var__m_sys_hub_action_input_65431bc21b1e58104be764e8bc4bcb5a</name>
        <next_element/>
        <order>2</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_action_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:40</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>837b53421b5e58104be764e8bc4bcbab</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:40</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_action_input>
    <sys_hub_step_instance action="delete_multiple" query="action=65431bc21b1e58104be764e8bc4bcb5a^sys_idNOT IN837b53421b5e58104be764e8bc4bcbb3"/>
    <sys_hub_step_instance action="INSERT_OR_UPDATE">
        <action display_value="UPDATE_ProcessUpdate (v2.1)">65431bc21b1e58104be764e8bc4bcb5a</action>
        <cid>32ab521e-c2c5-4424-8abd-c8997be99e74</cid>
        <extended_inputs/>
        <extended_inputs/>
        <extended_outputs/>
        <icon/>
        <inputs/>
        <label>Script step</label>
        <order>1</order>
        <outputs/>
        <section/>
        <step_type display_value="Script">106afb6647032200b4fad7527c9a71e7</step_type>
        <sys_class_name>sys_hub_step_instance</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:40</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>837b53421b5e58104be764e8bc4bcbb3</sys_id>
        <sys_mod_count>15</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:05</sys_updated_on>
    </sys_hub_step_instance>
    <sys_variable_value action="delete_multiple" query="document_key=837b53421b5e58104be764e8bc4bcbb3"/>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>837b53421b5e58104be764e8bc4bcbb3</document_key>
        <order>400</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>4f7b53421b5e58104be764e8bc4bcbc6</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <value>35aa573fd7802200bdbaee5b5e610375</value>
        <variable display_value="">f5e56d79b3101300176b051a16a8dce4</variable>
    </sys_variable_value>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>837b53421b5e58104be764e8bc4bcbb3</document_key>
        <order>600</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>877b53421b5e58104be764e8bc4bcbc7</sys_id>
        <sys_mod_count>14</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:05</sys_updated_on>
        <value>/*

This should be called every time a computer gets an update.

This script does the following:
1. Determine whether we have a currently linked device.
   If no, queue up a novel device link attempt.
   If yes, continue.
2. Iterate through all fields that have been updated. For each field, queue the appropriate item into the appropriate operation queue (prop,att).
3. If any fields updated, queue an arp entry as well.

*/
//x_fmcna_armis_inte_armis_snow_novel_link_queue

//GENERAL FUNCTION LIBRARY v0.9 MINIFIED
//SEE FUNCTION_LIBRARY ACTION FOR DOCUMENTATION AND FULL VERSION
function now(){return(new GlideDateTime).getNumericValue()}function lapReport(e){var r="("+(now()-e)+"ms)";return e=now(),r}function includes(e,r){for(var t=0;t&lt;e.length;t++)if(e[t]==r)return!0;return!1}function digest(e){for(var r=5381,t=e.length;t;)r=33*r^e.charCodeAt(--t);return r&gt;&gt;&gt;0}function isValidIPAddress(e){return!!RegExp("^([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])$").test(e)||!!RegExp("^((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*::((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*|((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4})){7}$").test(e)}function isValidMACAddress(e){return RegExp("^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})|([0-9a-fA-F]{4}\\.[0-9a-fA-F]{4}\\.[0-9a-fA-F]{4})$").test(e)}function generateID(){var e="";arr="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var r=6;r&gt;0;r--)e+=arr[Math.floor(Math.random()*arr.length)];return e}function insertOrUpdate(e){var r={},t=now();null==e.unique_pairs&amp;&amp;(e.unique_pairs=[]);try{var a=new GlideRecord(e.table);if(0!=e.unique_pairs.length){for(var i=0;i&lt;e.unique_pairs.length;i++)a.addQuery(e.unique_pairs[i][0],e.unique_pairs[i][1]);a.query()}if(0==a.getRowCount()){a.initialize();for(i=0;i&lt;e.unique_pairs.length;i++)a[e.unique_pairs[i][0]]=e.unique_pairs[i][1];for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.insert(),r.operation="insert"}else{for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.updateMultiple(),r.operation="update"}}catch(e){r.operation="error: "+e}return r.time_delta=now()-t,r}function writeToActionLog(e){var r={table:"x_fmcna_armis_inte_armis_action_log"};return r.unique_pairs=[["execution_id",e.id]],r.update_pairs=[["action_type",e.action_type],["api_time",e.api_time],["heavy_processing_time",e.heavy_processing_time],["total_time",e.total_time],["report",(""+e.report).substring(0,199)],["debug_string",(""+e.debug_string).substring(0,1999)]],insertOrUpdate(r)}function writeToErrorLog(e){var r={table:"x_fmcna_armis_inte_armis_error_log"};return r.unique_pairs=[["execution_id",e.id]],r.update_pairs=[["error_message",e.error_message],["debug_string",e.debug_string]],insertOrUpdate(r)}function getConfigValue(e){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_configuration");return r.addQuery("key",e),r.query(),0==r.getRowCount()?"":(r.next(),r.getValue("value"))}function getCacheValue(e,r){var t=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");if(t.addQuery("key",e),t.query(),0==t.getRowCount())return null;switch(t.next(),r){case"str":return t.getValue("value_string");case"int":return t.getValue("value_int");case"datetime":return t.getValue("value_datetime")}}function getCurrentToken(){return getCacheValue("token","str")}function setCacheValue(e,r,t){var a={table:"x_fmcna_armis_inte_armis_integration_cache"};switch(a.unique_pairs=[["key",e]],t){case"str":a.update_pairs=[["value_string",r]];break;case"int":a.update_pairs=[["value_int",r]];break;case"datetime":a.update_pairs=[["value_datetime",r]]}return insertOrUpdate(a)}function deleteCacheValue(e){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");r.addQuery("key",e),r.query(),r.deleteMultiple()}


//'TABLES AND REST' FUNCTION LIBRARY v0.13 MINIFIED
//SEE FUNCTION_LIBRARY ACTION FOR DOCUMENTATION AND FULL VERSION
function writeToAPILog(e){null==e.payload&amp;&amp;(e.payload=""),null==e.response_body&amp;&amp;(e.response_body="");var t={table:"x_fmcna_armis_inte_armis_rest_api_log"};return t.update_pairs=[["execution_id",e.id],["api_endpoint",e.endpoint],["payload",(""+e.payload).substring(0,1999)],["response_code",e.response_code],["response_body",(""+e.response_body).substring(0,1999)],["query_submitted_at",e.start_time],["query_response_time_ms",e.time_delta_ms]],insertOrUpdate(t)}function queueProperty(e){if(null==e.name||""==e.name)return{operation:"error: empty name",time_delta:0};if(null==e.value||""==e.value)return{operation:"error: empty value",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_property_upload"};return t.unique_pairs=[["armis_device_id",e.armis_id],["property_name",e.name]],t.update_pairs=[["property_value",e.value],["execution_id",e.execution_id],["status","PENDING"]],insertOrUpdate(t)}function queueARP(e){if(null==e.mac||""==e.mac)return{operation:"error: empty mac",time_delta:0};if(null==e.ip||""==e.ip)return{operation:"error: empty ip",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_arp_table"};return t.update_pairs=[["execution_id",e.execution_id],["mac",e.mac],["ip",e.ip],["status","PENDING"]],insertOrUpdate(t)}function queueKeyAttribute(e){if(!(null!=e.armis_id&amp;&amp;""!=e.armis_id||null!=e.mac&amp;&amp;""!=e.mac))return{operation:"error: must have either a MAC or an Armis ID",time_delta:0};if(allowed_attributes=["CATEGORY","IP","LAST_SEEN","MODEL","NAME","OS","OS_VERSION","TAG","TYPE","USER"],0==includes(allowed_attributes,e.attribute))return{operation:"error: attribute '"+e.attribute+"' is not valid.",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_key_attribute"};return t.unique_pairs=[["armis_mac",e.mac],["attribute",e.attribute]],t.update_pairs=[["execution_id",e.execution_id],["armis_device_id",e.armis_id],["value",e.value],["status","PENDING"]],insertOrUpdate(t)}function queueApplication(e){if(null==e.armis_id||""==e.armis_id)return{operation:"error: Armis ID cannot be empty",time_delta:0};if(null==e.name||""==e.name)return{operation:"error: Software name cannot be empty",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_application_upload"};return t.unique_pairs=[["armis_device_id",e.armis_id],["application_name",e.name]],t.update_pairs=[["execution_id",e.execution_id],["application_version",e.version],["status","PENDING"]],insertOrUpdate(t)}function executeStandardREST(e){try{var t=new GlideDateTime,i=new sn_ws.RESTMessageV2("Armis API",e.endpoint);i.setRequestHeader("Authorization",getCurrentToken()),i.setRequestHeader("accept","application/json"),i.setRequestHeader("content-type","application/json"),null==e.query_params&amp;&amp;(e.query_params=[]);for(var a=0;a&lt;e.query_params.length;a++)i.setQueryParameter(e.query_params[a][0],e.query_params[a][1]);i.setRequestBody(e.payload);var r,n=now(),s={};return 1==e.async?r=i.executeAsync():(r=i.execute(),s.response_code=r.getStatusCode(),s.response_body=r.getBody()),s.api_time=now()-n,writeToAPILog({id:e.id,endpoint:e.endpoint,payload:e.payload,response_code:s.response_code,response_body:s.response_body,start_time:t,time_delta_ms:s.api_time}),s}catch(e){return(s={response_code:"xx"}).response_body="Failed to build query. "+e,s.api_time=0,s}}function queueAttachmentREST(e){var t=new GlideRecord("sys_attachment"),i=(new GlideSysAttachment).write(t,e.id+".csv","text/plain",e.payload),a=new GlideRecord("x_fmcna_armis_inte_armis_attachment_upload");a.initialize(),a.attachment=i,a.execution_id=e.id,a.status="PENDING",a.type=e.type,a.content=e.payload,a.insert()}function getBestMAC(e){if(isValidMACAddress(e.mac_address)&amp;&amp;!e.mac_address.endsWith("00:00:01"))return e.mac_address;var t=new GlideRecord("cmdb_ci_network_adapter");t.addQuery("cmdb_ci",e.sys_id),t.query();for(var i=null,a=-1e3;t.next();)if(isValidMACAddress(t.mac_address)&amp;&amp;!t.mac_address.endsWith("00:00:01")){var r=0;t.ip_address.startsWith("10.")&amp;&amp;(r+=1e3),t.name.startsWith("Local Area")&amp;&amp;(r+=900);var n=new GlideAggregate("cmdb_ci_network_adapter");n.addAggregate("COUNT"),n.addQuery("mac_address",t.mac_address),n.query(),n.next()&amp;&amp;(r-=n.getAggregate("COUNT")),r&gt;a&amp;&amp;r&gt;0&amp;&amp;(i=""+t.mac_address,a=r)}return i}function queueInitialARPandCSV(e,t){var i=getBestMAC(e),a=e.ip_address;isValidMACAddress(i)&amp;&amp;isValidIPAddress(a)&amp;&amp;(queueARP({execution_id:t,mac:i,ip:a}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"NAME",value:""+e.name}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"IP",value:a}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"TAG",value:getConfigValue("armis_import_universal_tag")}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"LAST_SEEN",value:(new GlideDateTime).getDisplayValue().replace(" ","T")}),null!=e.model_id&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"MODEL",value:e.model_id.getDisplayValue()}),null!=e.os&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"OS",value:e.os.getDisplayValue()}),null!=e.os_version&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"OS_VERSION",value:e.os_version}),null!=e.users&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"USER",value:e.users}))}function getPendingRecordsEndSysID(e,t,i){null==i&amp;&amp;(i={}),null==i.force_field&amp;&amp;(i.force_field="status"),null==i.force_pending&amp;&amp;(i.force_pending="PENDING");var a=new GlideRecord(t);for(a.addQuery(i.force_field,i.force_pending),a.setLimit(e),a.orderBy("sys_id"),a.query();a.next();)if(0==a.hasNext())return a.getValue("sys_id");return null}function getNumPendingRecords(e,t,i,a){null==a&amp;&amp;(a={}),null==a.force_field&amp;&amp;(a.force_field="status"),null==a.force_pending&amp;&amp;(a.force_pending="PENDING");var r=new GlideRecord(t);return r.addQuery(a.force_field,a.force_pending),r.setLimit(e),r.orderBy("sys_id"),r.addQuery("sys_id","&lt;=",i),r.query(),r}






(function execute(inputs, outputs) {
 
  var start_time = now()
  var eid = generateID()
  var lap = now()
  var error_report = ''
  var report_string = ''
  var num_properties = 0
  var debug = ['BEGIN DEVICE ' + inputs.computer_sys_id]
  
  
  try 
  {
    //Grab the computer associated with this sys_id, kill process if none.
    //(Doing this because I've had cases where a trigger occurs on a device that doesn't end up actually existing, 'tis weird
    if(inputs.computer_sys_id == '') { return }
    var snow_device = new GlideRecord('cmdb_ci_computer')
    snow_device.addQuery('sys_id',inputs.computer_sys_id)
    snow_device.query()
    if(!snow_device.next()) { return }
    
    report_string += "Computer '" + snow_device.name + "': "

    debug.push("SNOW Device: '" + snow_device.name + "' " + lapReport(lap));lap=now()

    //STEP ONE -- DOES THIS DEVICE HAVE A LINKED ARMIS DEVICE?


    var armis_device = new GlideRecord('x_fmcna_armis_inte_armis_device_table')
    armis_device.addQuery('linked_snow_computer',inputs.computer_sys_id)
    armis_device.query()
    if(!armis_device.next())
    {
      //No Armis device. Queue a novel device link push and exit.
      debug.push("No linked Armis device. Pushing ARP and CSV. "+ lapReport(lap));lap=now()
      report_string += 'no link, pushed ARP and CSV values.'
      queueInitialARPandCSV(snow_device,eid)
      debug.push("Queued. "+ lapReport(lap));lap=now()
    }
    else
    {
      debug.push("Linked Armis device '" + armis_device.name + "'. Proceeding to update. "+ lapReport(lap));lap=now()

      //STEP TWO -- ITERATE THROUGH FIELDS, AND IF ANY MATCH, QUEUE THOSE PROPERTIES.

      //Combine property references (did multiple config fields for extensibility)
      var property_reference = getConfigValue('snow_property_reference_1') + getConfigValue('snow_property_reference_2') + getConfigValue('snow_property_reference_3')
      property_reference = property_reference.split(',')

      //Split propertes. We will end up with a dictionary of the form { field_name: 'display value'} that we will use to govern what gets sent to Armis.
      var property_dictionary = {}
      for(var i=0;i&lt;property_reference.length;i++) { var p = property_reference[i].split(':'); property_dictionary[p[0]] = p[1] }

      //Iterate through our given update fields. Note that these are an array in the form of:
      /* [{
        "previous_display_value": "internal_2008T-OS_5.0.376a",
        "previous_value": "internal_2008T-OS_5.0.376a",
        "current_display_value": "internal_2008T-OS_5.0.376",
        "current_value": "internal_2008T-OS_5.0.376",
        "field_name": "u_image"
      }] */

      for(var i=0;i&lt;inputs.fields.length;i++)
      {
        var field_name = inputs.fields[i].field_name
        if (field_name in property_dictionary)
        {
          var display_value = inputs.fields[i].current_display_value
          queueProperty({armis_id: armis_device.armis_device_id, execution_id: eid, name: property_dictionary[field_name], value: display_value})
          debug.push( field_name + ": queued property upload of value '" + display_value + "' "+ lapReport(lap));lap=now()
          num_properties++

          //Some specific field names need to be pushed as CSV uploads too.
          switch(field_name)
          {
            case 'name':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'NAME', value: display_value})
              debug.push("NAME" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'ip_address':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'IP', value: display_value})
              debug.push("IP" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'model_id':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'MODEL', value: display_value})
              debug.push("MODEL" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'os':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'OS', value: display_value})
              debug.push("OS" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'os_version':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'OS_VERSION', value: display_value})
              debug.push("OS_VERSION" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'assigned_to':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'USER', value: display_value})
              debug.push("USER" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
          }
        report_string += 'queued ' + num_properties + ' for upload.'
        }
        else
        {
          //This isn't a field we're interested in.
          debug.push( field_name + ": no upload needed "+ lapReport(lap));lap=now()
        }
      }
    }
  }
  catch(ex)
  {
    error_report = '[ERROR: ' + ex + '] '
    debug.push(error_report)
    writeToErrorLog({id: eid, error_message: ex, debug_string: debug.join('\n')})
    
  }
  
  debug = debug.join('\n')
  report_string = error_report + report_string
  outputs.debug = debug
  writeToActionLog({id: eid, action_type: 'trigger_computer_update', total_time: (now() - start_time), api_time: 0, heavy_processing_time: (now() - start_time), report: report_string, debug_string: debug})
  
})(inputs, outputs);
</value>
        <variable display_value="">71aa7f6647032200b4fad7527c9a719b</variable>
    </sys_variable_value>
    <sys_element_mapping action="delete_multiple" query="id=837b53421b5e58104be764e8bc4bcbb3"/>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>application</field>
        <id>837b53421b5e58104be764e8bc4bcbb3</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>077b53421b5e58104be764e8bc4bcbc6</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>computer_sys_id</field>
        <id>837b53421b5e58104be764e8bc4bcbb3</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>c37b53421b5e58104be764e8bc4bcbc8</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_837b53421b5e58104be764e8bc4bcbb3</table>
        <value>{{action.computer_sys_id}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>fields</field>
        <id>837b53421b5e58104be764e8bc4bcbb3</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>877b53421b5e58104be764e8bc4bcbc8</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_837b53421b5e58104be764e8bc4bcbb3</table>
        <value>{{action.fields}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>script</field>
        <id>837b53421b5e58104be764e8bc4bcbb3</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_id>cb7b53421b5e58104be764e8bc4bcbc6</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_hub_step_ext_input action="delete_multiple" query="model=837b53421b5e58104be764e8bc4bcbb3^sys_idNOT IN877b53421b5e58104be764e8bc4bcbb8,8f7b53421b5e58104be764e8bc4bcbbd"/>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>fields</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label/>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">837b53421b5e58104be764e8bc4bcbb3</model>
        <model_id>837b53421b5e58104be764e8bc4bcbb3</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_837b53421b5e58104be764e8bc4bcbb3</name>
        <next_element/>
        <order>0</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>877b53421b5e58104be764e8bc4bcbb8</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>computer_sys_id</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label/>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">837b53421b5e58104be764e8bc4bcbb3</model>
        <model_id>837b53421b5e58104be764e8bc4bcbb3</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_837b53421b5e58104be764e8bc4bcbb3</name>
        <next_element/>
        <order>100</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:41</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>8f7b53421b5e58104be764e8bc4bcbbd</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:41</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_output action="delete_multiple" query="model=837b53421b5e58104be764e8bc4bcbb3^sys_idNOT INf9343b0a1bde58104be764e8bc4bcb4f"/>
    <sys_hub_step_ext_output action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string,uiTypeLabel=String,uiUniqueId=312462aa-8d91-4371-bcb5-f1571b47d036</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>debug</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>debug</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">837b53421b5e58104be764e8bc4bcbb3</model>
        <model_id>837b53421b5e58104be764e8bc4bcbb3</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_output_837b53421b5e58104be764e8bc4bcbb3</name>
        <next_element/>
        <order>1</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_output</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:25:43</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>f9343b0a1bde58104be764e8bc4bcb4f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:25:43</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_output>
    <sys_documentation action="delete_multiple" query="name=var__m_sys_hub_action_input_65431bc21b1e58104be764e8bc4bcb5a^sys_idNOT IN437b53421b5e58104be764e8bc4bcbb0,cb7b53421b5e58104be764e8bc4bcba9"/>
    <sys_documentation action="INSERT_OR_UPDATE">
        <element>computer_sys_id</element>
        <help/>
        <hint/>
        <label>computer_sys_id</label>
        <language>en</language>
        <name>var__m_sys_hub_action_input_65431bc21b1e58104be764e8bc4bcb5a</name>
        <plural/>
        <sys_class_name>sys_documentation</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:40</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>437b53421b5e58104be764e8bc4bcbb0</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package display_value="Armis Integration" source="x_fmcna_armis_inte">7574b5e3dbf4d050cb24431e13961986</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:40</sys_updated_on>
        <url/>
        <url_target/>
    </sys_documentation>
    <sys_documentation action="INSERT_OR_UPDATE">
        <element>fields</element>
        <help/>
        <hint/>
        <label>fields</label>
        <language>en</language>
        <name>var__m_sys_hub_action_input_65431bc21b1e58104be764e8bc4bcb5a</name>
        <plural/>
        <sys_class_name>sys_documentation</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 00:37:40</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>cb7b53421b5e58104be764e8bc4bcba9</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package display_value="Armis Integration" source="x_fmcna_armis_inte">7574b5e3dbf4d050cb24431e13961986</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 00:37:40</sys_updated_on>
        <url/>
        <url_target/>
    </sys_documentation>
    <sys_hub_action_plan action="delete_multiple" query="action_id=65431bc21b1e58104be764e8bc4bcb5a^sys_idNOT INaf44fb0a1bde58104be764e8bc4bcb98"/>
    <sys_hub_action_plan action="INSERT_OR_UPDATE">
        <action_id display_value="UPDATE_ProcessUpdate (v2.1)">65431bc21b1e58104be764e8bc4bcb5a</action_id>
        <plan>{"persistor":{"@class":".ChunkingPlanPersistor","table":"sys_hub_action_plan","id":"af44fb0a1bde58104be764e8bc4bcb98","name":"plan"}}</plan>
        <snapshot>71c6508c1b2610104ca7edf9bc4bcb1a</snapshot>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:07</sys_created_on>
        <sys_domain>global</sys_domain>
        <sys_id>af44fb0a1bde58104be764e8bc4bcb98</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_overrides/>
        <sys_scope/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:08</sys_updated_on>
    </sys_hub_action_plan>
    <sys_hub_action_type_snapshot action="INSERT_OR_UPDATE">
        <access>public</access>
        <acls/>
        <action_template/>
        <annotation/>
        <callable_by_client_api>false</callable_by_client_api>
        <category/>
        <copied_from/>
        <copied_from_name/>
        <description/>
        <internal_name>update_processupdate_v21</internal_name>
        <label_cache>[{"name":"{{action.fields}}","label":"action➛fields","type":"action","ref":""},{"name":"{{action.computer}}","label":"action➛computer","type":"action","ref":""},{"name":"{{action.computer_sys_id}}","label":"action➛computer_sys_id","type":"action","ref":""},{"name":"{{step[32ab521e-c2c5-4424-8abd-c8997be99e74].variable}}","label":"step➛Script step➛variable","type":"step","ref":""},{"name":"{{step[32ab521e-c2c5-4424-8abd-c8997be99e74].debug}}","label":"step➛Script step➛debug","type":"step","ref":""}]</label_cache>
        <master>true</master>
        <name>UPDATE_ProcessUpdate (v2.1)</name>
        <natlang/>
        <outputs/>
        <parent_action display_value="UPDATE_ProcessUpdate (v2.1)">65431bc21b1e58104be764e8bc4bcb5a</parent_action>
        <sys_class_name>sys_hub_action_type_snapshot</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_domain>global</sys_domain>
        <sys_id>8344bb0a1bde58104be764e8bc4bcbee</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_overrides/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <system_level>false</system_level>
        <type/>
    </sys_hub_action_type_snapshot>
    <sys_variable_value action="delete_multiple" query="document_key=8344bb0a1bde58104be764e8bc4bcbee"/>
    <sys_hub_step_instance action="delete_multiple" query="action=8344bb0a1bde58104be764e8bc4bcbee^sys_idNOT INdf44bb0a1bde58104be764e8bc4bcbff"/>
    <sys_hub_step_instance action="INSERT_OR_UPDATE">
        <action display_value="UPDATE_ProcessUpdate (v2.1)">8344bb0a1bde58104be764e8bc4bcbee</action>
        <cid>32ab521e-c2c5-4424-8abd-c8997be99e74</cid>
        <extended_inputs/>
        <extended_inputs/>
        <extended_outputs/>
        <icon/>
        <inputs/>
        <label>Script step</label>
        <order>1</order>
        <outputs/>
        <section/>
        <step_type display_value="Script">106afb6647032200b4fad7527c9a71e7</step_type>
        <sys_class_name>sys_hub_step_instance</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>df44bb0a1bde58104be764e8bc4bcbff</sys_id>
        <sys_mod_count>13</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:07</sys_updated_on>
    </sys_hub_step_instance>
    <sys_variable_value action="delete_multiple" query="document_key=df44bb0a1bde58104be764e8bc4bcbff"/>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>df44bb0a1bde58104be764e8bc4bcbff</document_key>
        <order>600</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>5344fb0a1bde58104be764e8bc4bcb3f</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:07</sys_updated_on>
        <value>/*

This should be called every time a computer gets an update.

This script does the following:
1. Determine whether we have a currently linked device.
   If no, queue up a novel device link attempt.
   If yes, continue.
2. Iterate through all fields that have been updated. For each field, queue the appropriate item into the appropriate operation queue (prop,att).
3. If any fields updated, queue an arp entry as well.

*/
//x_fmcna_armis_inte_armis_snow_novel_link_queue

//GENERAL FUNCTION LIBRARY v0.9 MINIFIED
//SEE FUNCTION_LIBRARY ACTION FOR DOCUMENTATION AND FULL VERSION
function now(){return(new GlideDateTime).getNumericValue()}function lapReport(e){var r="("+(now()-e)+"ms)";return e=now(),r}function includes(e,r){for(var t=0;t&lt;e.length;t++)if(e[t]==r)return!0;return!1}function digest(e){for(var r=5381,t=e.length;t;)r=33*r^e.charCodeAt(--t);return r&gt;&gt;&gt;0}function isValidIPAddress(e){return!!RegExp("^([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])$").test(e)||!!RegExp("^((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*::((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*|((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4})){7}$").test(e)}function isValidMACAddress(e){return RegExp("^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})|([0-9a-fA-F]{4}\\.[0-9a-fA-F]{4}\\.[0-9a-fA-F]{4})$").test(e)}function generateID(){var e="";arr="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var r=6;r&gt;0;r--)e+=arr[Math.floor(Math.random()*arr.length)];return e}function insertOrUpdate(e){var r={},t=now();null==e.unique_pairs&amp;&amp;(e.unique_pairs=[]);try{var a=new GlideRecord(e.table);if(0!=e.unique_pairs.length){for(var i=0;i&lt;e.unique_pairs.length;i++)a.addQuery(e.unique_pairs[i][0],e.unique_pairs[i][1]);a.query()}if(0==a.getRowCount()){a.initialize();for(i=0;i&lt;e.unique_pairs.length;i++)a[e.unique_pairs[i][0]]=e.unique_pairs[i][1];for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.insert(),r.operation="insert"}else{for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.updateMultiple(),r.operation="update"}}catch(e){r.operation="error: "+e}return r.time_delta=now()-t,r}function writeToActionLog(e){var r={table:"x_fmcna_armis_inte_armis_action_log"};return r.unique_pairs=[["execution_id",e.id]],r.update_pairs=[["action_type",e.action_type],["api_time",e.api_time],["heavy_processing_time",e.heavy_processing_time],["total_time",e.total_time],["report",(""+e.report).substring(0,199)],["debug_string",(""+e.debug_string).substring(0,1999)]],insertOrUpdate(r)}function writeToErrorLog(e){var r={table:"x_fmcna_armis_inte_armis_error_log"};return r.unique_pairs=[["execution_id",e.id]],r.update_pairs=[["error_message",e.error_message],["debug_string",e.debug_string]],insertOrUpdate(r)}function getConfigValue(e){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_configuration");return r.addQuery("key",e),r.query(),0==r.getRowCount()?"":(r.next(),r.getValue("value"))}function getCacheValue(e,r){var t=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");if(t.addQuery("key",e),t.query(),0==t.getRowCount())return null;switch(t.next(),r){case"str":return t.getValue("value_string");case"int":return t.getValue("value_int");case"datetime":return t.getValue("value_datetime")}}function getCurrentToken(){return getCacheValue("token","str")}function setCacheValue(e,r,t){var a={table:"x_fmcna_armis_inte_armis_integration_cache"};switch(a.unique_pairs=[["key",e]],t){case"str":a.update_pairs=[["value_string",r]];break;case"int":a.update_pairs=[["value_int",r]];break;case"datetime":a.update_pairs=[["value_datetime",r]]}return insertOrUpdate(a)}function deleteCacheValue(e){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");r.addQuery("key",e),r.query(),r.deleteMultiple()}


//'TABLES AND REST' FUNCTION LIBRARY v0.13 MINIFIED
//SEE FUNCTION_LIBRARY ACTION FOR DOCUMENTATION AND FULL VERSION
function writeToAPILog(e){null==e.payload&amp;&amp;(e.payload=""),null==e.response_body&amp;&amp;(e.response_body="");var t={table:"x_fmcna_armis_inte_armis_rest_api_log"};return t.update_pairs=[["execution_id",e.id],["api_endpoint",e.endpoint],["payload",(""+e.payload).substring(0,1999)],["response_code",e.response_code],["response_body",(""+e.response_body).substring(0,1999)],["query_submitted_at",e.start_time],["query_response_time_ms",e.time_delta_ms]],insertOrUpdate(t)}function queueProperty(e){if(null==e.name||""==e.name)return{operation:"error: empty name",time_delta:0};if(null==e.value||""==e.value)return{operation:"error: empty value",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_property_upload"};return t.unique_pairs=[["armis_device_id",e.armis_id],["property_name",e.name]],t.update_pairs=[["property_value",e.value],["execution_id",e.execution_id],["status","PENDING"]],insertOrUpdate(t)}function queueARP(e){if(null==e.mac||""==e.mac)return{operation:"error: empty mac",time_delta:0};if(null==e.ip||""==e.ip)return{operation:"error: empty ip",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_arp_table"};return t.update_pairs=[["execution_id",e.execution_id],["mac",e.mac],["ip",e.ip],["status","PENDING"]],insertOrUpdate(t)}function queueKeyAttribute(e){if(!(null!=e.armis_id&amp;&amp;""!=e.armis_id||null!=e.mac&amp;&amp;""!=e.mac))return{operation:"error: must have either a MAC or an Armis ID",time_delta:0};if(allowed_attributes=["CATEGORY","IP","LAST_SEEN","MODEL","NAME","OS","OS_VERSION","TAG","TYPE","USER"],0==includes(allowed_attributes,e.attribute))return{operation:"error: attribute '"+e.attribute+"' is not valid.",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_key_attribute"};return t.unique_pairs=[["armis_mac",e.mac],["attribute",e.attribute]],t.update_pairs=[["execution_id",e.execution_id],["armis_device_id",e.armis_id],["value",e.value],["status","PENDING"]],insertOrUpdate(t)}function queueApplication(e){if(null==e.armis_id||""==e.armis_id)return{operation:"error: Armis ID cannot be empty",time_delta:0};if(null==e.name||""==e.name)return{operation:"error: Software name cannot be empty",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_application_upload"};return t.unique_pairs=[["armis_device_id",e.armis_id],["application_name",e.name]],t.update_pairs=[["execution_id",e.execution_id],["application_version",e.version],["status","PENDING"]],insertOrUpdate(t)}function executeStandardREST(e){try{var t=new GlideDateTime,i=new sn_ws.RESTMessageV2("Armis API",e.endpoint);i.setRequestHeader("Authorization",getCurrentToken()),i.setRequestHeader("accept","application/json"),i.setRequestHeader("content-type","application/json"),null==e.query_params&amp;&amp;(e.query_params=[]);for(var a=0;a&lt;e.query_params.length;a++)i.setQueryParameter(e.query_params[a][0],e.query_params[a][1]);i.setRequestBody(e.payload);var r,n=now(),s={};return 1==e.async?r=i.executeAsync():(r=i.execute(),s.response_code=r.getStatusCode(),s.response_body=r.getBody()),s.api_time=now()-n,writeToAPILog({id:e.id,endpoint:e.endpoint,payload:e.payload,response_code:s.response_code,response_body:s.response_body,start_time:t,time_delta_ms:s.api_time}),s}catch(e){return(s={response_code:"xx"}).response_body="Failed to build query. "+e,s.api_time=0,s}}function queueAttachmentREST(e){var t=new GlideRecord("sys_attachment"),i=(new GlideSysAttachment).write(t,e.id+".csv","text/plain",e.payload),a=new GlideRecord("x_fmcna_armis_inte_armis_attachment_upload");a.initialize(),a.attachment=i,a.execution_id=e.id,a.status="PENDING",a.type=e.type,a.content=e.payload,a.insert()}function getBestMAC(e){if(isValidMACAddress(e.mac_address)&amp;&amp;!e.mac_address.endsWith("00:00:01"))return e.mac_address;var t=new GlideRecord("cmdb_ci_network_adapter");t.addQuery("cmdb_ci",e.sys_id),t.query();for(var i=null,a=-1e3;t.next();)if(isValidMACAddress(t.mac_address)&amp;&amp;!t.mac_address.endsWith("00:00:01")){var r=0;t.ip_address.startsWith("10.")&amp;&amp;(r+=1e3),t.name.startsWith("Local Area")&amp;&amp;(r+=900);var n=new GlideAggregate("cmdb_ci_network_adapter");n.addAggregate("COUNT"),n.addQuery("mac_address",t.mac_address),n.query(),n.next()&amp;&amp;(r-=n.getAggregate("COUNT")),r&gt;a&amp;&amp;r&gt;0&amp;&amp;(i=""+t.mac_address,a=r)}return i}function queueInitialARPandCSV(e,t){var i=getBestMAC(e),a=e.ip_address;isValidMACAddress(i)&amp;&amp;isValidIPAddress(a)&amp;&amp;(queueARP({execution_id:t,mac:i,ip:a}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"NAME",value:""+e.name}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"IP",value:a}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"TAG",value:getConfigValue("armis_import_universal_tag")}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"LAST_SEEN",value:(new GlideDateTime).getDisplayValue().replace(" ","T")}),null!=e.model_id&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"MODEL",value:e.model_id.getDisplayValue()}),null!=e.os&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"OS",value:e.os.getDisplayValue()}),null!=e.os_version&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"OS_VERSION",value:e.os_version}),null!=e.users&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"USER",value:e.users}))}function getPendingRecordsEndSysID(e,t,i){null==i&amp;&amp;(i={}),null==i.force_field&amp;&amp;(i.force_field="status"),null==i.force_pending&amp;&amp;(i.force_pending="PENDING");var a=new GlideRecord(t);for(a.addQuery(i.force_field,i.force_pending),a.setLimit(e),a.orderBy("sys_id"),a.query();a.next();)if(0==a.hasNext())return a.getValue("sys_id");return null}function getNumPendingRecords(e,t,i,a){null==a&amp;&amp;(a={}),null==a.force_field&amp;&amp;(a.force_field="status"),null==a.force_pending&amp;&amp;(a.force_pending="PENDING");var r=new GlideRecord(t);return r.addQuery(a.force_field,a.force_pending),r.setLimit(e),r.orderBy("sys_id"),r.addQuery("sys_id","&lt;=",i),r.query(),r}






(function execute(inputs, outputs) {
 
  var start_time = now()
  var eid = generateID()
  var lap = now()
  var error_report = ''
  var report_string = ''
  var num_properties = 0
  var debug = ['BEGIN DEVICE ' + inputs.computer_sys_id]
  
  
  try 
  {
    //Grab the computer associated with this sys_id, kill process if none.
    //(Doing this because I've had cases where a trigger occurs on a device that doesn't end up actually existing, 'tis weird
    if(inputs.computer_sys_id == '') { return }
    var snow_device = new GlideRecord('cmdb_ci_computer')
    snow_device.addQuery('sys_id',inputs.computer_sys_id)
    snow_device.query()
    if(!snow_device.next()) { return }
    
    report_string += "Computer '" + snow_device.name + "': "

    debug.push("SNOW Device: '" + snow_device.name + "' " + lapReport(lap));lap=now()

    //STEP ONE -- DOES THIS DEVICE HAVE A LINKED ARMIS DEVICE?


    var armis_device = new GlideRecord('x_fmcna_armis_inte_armis_device_table')
    armis_device.addQuery('linked_snow_computer',inputs.computer_sys_id)
    armis_device.query()
    if(!armis_device.next())
    {
      //No Armis device. Queue a novel device link push and exit.
      debug.push("No linked Armis device. Pushing ARP and CSV. "+ lapReport(lap));lap=now()
      report_string += 'no link, pushed ARP and CSV values.'
      queueInitialARPandCSV(snow_device,eid)
      debug.push("Queued. "+ lapReport(lap));lap=now()
    }
    else
    {
      debug.push("Linked Armis device '" + armis_device.name + "'. Proceeding to update. "+ lapReport(lap));lap=now()

      //STEP TWO -- ITERATE THROUGH FIELDS, AND IF ANY MATCH, QUEUE THOSE PROPERTIES.

      //Combine property references (did multiple config fields for extensibility)
      var property_reference = getConfigValue('snow_property_reference_1') + getConfigValue('snow_property_reference_2') + getConfigValue('snow_property_reference_3')
      property_reference = property_reference.split(',')

      //Split propertes. We will end up with a dictionary of the form { field_name: 'display value'} that we will use to govern what gets sent to Armis.
      var property_dictionary = {}
      for(var i=0;i&lt;property_reference.length;i++) { var p = property_reference[i].split(':'); property_dictionary[p[0]] = p[1] }

      //Iterate through our given update fields. Note that these are an array in the form of:
      /* [{
        "previous_display_value": "internal_2008T-OS_5.0.376a",
        "previous_value": "internal_2008T-OS_5.0.376a",
        "current_display_value": "internal_2008T-OS_5.0.376",
        "current_value": "internal_2008T-OS_5.0.376",
        "field_name": "u_image"
      }] */

      for(var i=0;i&lt;inputs.fields.length;i++)
      {
        var field_name = inputs.fields[i].field_name
        if (field_name in property_dictionary)
        {
          var display_value = inputs.fields[i].current_display_value
          queueProperty({armis_id: armis_device.armis_device_id, execution_id: eid, name: property_dictionary[field_name], value: display_value})
          debug.push( field_name + ": queued property upload of value '" + display_value + "' "+ lapReport(lap));lap=now()
          num_properties++

          //Some specific field names need to be pushed as CSV uploads too.
          switch(field_name)
          {
            case 'name':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'NAME', value: display_value})
              debug.push("NAME" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'ip_address':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'IP', value: display_value})
              debug.push("IP" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'model_id':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'MODEL', value: display_value})
              debug.push("MODEL" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'os':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'OS', value: display_value})
              debug.push("OS" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'os_version':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'OS_VERSION', value: display_value})
              debug.push("OS_VERSION" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'assigned_to':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'USER', value: display_value})
              debug.push("USER" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
          }
        report_string += 'queued ' + num_properties + ' for upload.'
        }
        else
        {
          //This isn't a field we're interested in.
          debug.push( field_name + ": no upload needed "+ lapReport(lap));lap=now()
        }
      }
    }
  }
  catch(ex)
  {
    error_report = '[ERROR: ' + ex + '] '
    debug.push(error_report)
    writeToErrorLog({id: eid, error_message: ex, debug_string: debug.join('\n')})
    
  }
  
  debug = debug.join('\n')
  report_string = error_report + report_string
  outputs.debug = debug
  writeToActionLog({id: eid, action_type: 'trigger_computer_update', total_time: (now() - start_time), api_time: 0, heavy_processing_time: (now() - start_time), report: report_string, debug_string: debug})
  
})(inputs, outputs);
</value>
        <variable display_value="">71aa7f6647032200b4fad7527c9a719b</variable>
    </sys_variable_value>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>df44bb0a1bde58104be764e8bc4bcbff</document_key>
        <order>400</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>9f44fb0a1bde58104be764e8bc4bcb3e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <value>35aa573fd7802200bdbaee5b5e610375</value>
        <variable display_value="">f5e56d79b3101300176b051a16a8dce4</variable>
    </sys_variable_value>
    <sys_element_mapping action="delete_multiple" query="id=df44bb0a1bde58104be764e8bc4bcbff"/>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>application</field>
        <id>df44bb0a1bde58104be764e8bc4bcbff</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>5b44fb0a1bde58104be764e8bc4bcb3e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>computer_sys_id</field>
        <id>df44bb0a1bde58104be764e8bc4bcbff</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>db44fb0a1bde58104be764e8bc4bcb3f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_df44bb0a1bde58104be764e8bc4bcbff</table>
        <value>{{action.computer_sys_id}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>fields</field>
        <id>df44bb0a1bde58104be764e8bc4bcbff</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>9f44fb0a1bde58104be764e8bc4bcb3f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_df44bb0a1bde58104be764e8bc4bcbff</table>
        <value>{{action.fields}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>script</field>
        <id>df44bb0a1bde58104be764e8bc4bcbff</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>1f44fb0a1bde58104be764e8bc4bcb3e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_hub_step_ext_input action="delete_multiple" query="model=df44bb0a1bde58104be764e8bc4bcbff^sys_idNOT IN1f44fb0a1bde58104be764e8bc4bcb02,d744fb0a1bde58104be764e8bc4bcb09"/>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>fields</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>fields</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">df44bb0a1bde58104be764e8bc4bcbff</model>
        <model_id>df44bb0a1bde58104be764e8bc4bcbff</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_df44bb0a1bde58104be764e8bc4bcbff</name>
        <next_element/>
        <order>0</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>1f44fb0a1bde58104be764e8bc4bcb02</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>computer_sys_id</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>computer_sys_id</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">df44bb0a1bde58104be764e8bc4bcbff</model>
        <model_id>df44bb0a1bde58104be764e8bc4bcbff</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_df44bb0a1bde58104be764e8bc4bcbff</name>
        <next_element/>
        <order>100</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>d744fb0a1bde58104be764e8bc4bcb09</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_output action="delete_multiple" query="model=df44bb0a1bde58104be764e8bc4bcbff^sys_idNOT IN5344fb0a1bde58104be764e8bc4bcb10"/>
    <sys_hub_step_ext_output action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string,uiTypeLabel=String,uiUniqueId=312462aa-8d91-4371-bcb5-f1571b47d036</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>debug</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>debug</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">df44bb0a1bde58104be764e8bc4bcbff</model>
        <model_id>df44bb0a1bde58104be764e8bc4bcbff</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_output_df44bb0a1bde58104be764e8bc4bcbff</name>
        <next_element/>
        <order>1</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_output</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>5344fb0a1bde58104be764e8bc4bcb10</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_output>
    <sys_hub_action_input action="delete_multiple" query="model=8344bb0a1bde58104be764e8bc4bcbee^sys_idNOT IN9344bb0a1bde58104be764e8bc4bcbf1,9744bb0a1bde58104be764e8bc4bcbf8"/>
    <sys_hub_action_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>child_label=fields_child0,child_name=fields_child0,child_type=object,child_type_label=Object,child_uiUniqueId=75d7454c-8645-43c9-95a2-1a931a16659b,co_type_name=FDc2c6508c1a2610102033f068de19f248,element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=array.object,uiTypeLabel=Array.Object,uiUniqueId=e20c0e47-a3e4-4f8e-b9b7-9c10dcaf0945</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>fields</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>fields</label>
        <mandatory>false</mandatory>
        <max_length>65000</max_length>
        <model display_value="UPDATE_ProcessUpdate (v2.1)">8344bb0a1bde58104be764e8bc4bcbee</model>
        <model_id>8344bb0a1bde58104be764e8bc4bcbee</model_id>
        <model_table>sys_hub_action_type_snapshot</model_table>
        <name>var__m_sys_hub_action_input_8344bb0a1bde58104be764e8bc4bcbee</name>
        <next_element/>
        <order>1</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_action_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>9344bb0a1bde58104be764e8bc4bcbf1</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:07</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_action_input>
    <sys_hub_action_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string,uiTypeLabel=String,uiUniqueId=1a25cdfd-7779-4058-b808-6639fe96482f</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>computer_sys_id</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>computer_sys_id</label>
        <mandatory>false</mandatory>
        <max_length>8000</max_length>
        <model display_value="UPDATE_ProcessUpdate (v2.1)">8344bb0a1bde58104be764e8bc4bcbee</model>
        <model_id>8344bb0a1bde58104be764e8bc4bcbee</model_id>
        <model_table>sys_hub_action_type_snapshot</model_table>
        <name>var__m_sys_hub_action_input_8344bb0a1bde58104be764e8bc4bcbee</name>
        <next_element/>
        <order>2</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_action_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>9744bb0a1bde58104be764e8bc4bcbf8</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_action_input>
    <sys_hub_step_instance action="delete_multiple" query="action=8344bb0a1bde58104be764e8bc4bcbee^sys_idNOT INdf44bb0a1bde58104be764e8bc4bcbff"/>
    <sys_hub_step_instance action="INSERT_OR_UPDATE">
        <action display_value="UPDATE_ProcessUpdate (v2.1)">8344bb0a1bde58104be764e8bc4bcbee</action>
        <cid>32ab521e-c2c5-4424-8abd-c8997be99e74</cid>
        <extended_inputs/>
        <extended_inputs/>
        <extended_outputs/>
        <icon/>
        <inputs/>
        <label>Script step</label>
        <order>1</order>
        <outputs/>
        <section/>
        <step_type display_value="Script">106afb6647032200b4fad7527c9a71e7</step_type>
        <sys_class_name>sys_hub_step_instance</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>df44bb0a1bde58104be764e8bc4bcbff</sys_id>
        <sys_mod_count>13</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:07</sys_updated_on>
    </sys_hub_step_instance>
    <sys_variable_value action="delete_multiple" query="document_key=df44bb0a1bde58104be764e8bc4bcbff"/>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>df44bb0a1bde58104be764e8bc4bcbff</document_key>
        <order>600</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>5344fb0a1bde58104be764e8bc4bcb3f</sys_id>
        <sys_mod_count>12</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-08-05 15:26:07</sys_updated_on>
        <value>/*

This should be called every time a computer gets an update.

This script does the following:
1. Determine whether we have a currently linked device.
   If no, queue up a novel device link attempt.
   If yes, continue.
2. Iterate through all fields that have been updated. For each field, queue the appropriate item into the appropriate operation queue (prop,att).
3. If any fields updated, queue an arp entry as well.

*/
//x_fmcna_armis_inte_armis_snow_novel_link_queue

//GENERAL FUNCTION LIBRARY v0.9 MINIFIED
//SEE FUNCTION_LIBRARY ACTION FOR DOCUMENTATION AND FULL VERSION
function now(){return(new GlideDateTime).getNumericValue()}function lapReport(e){var r="("+(now()-e)+"ms)";return e=now(),r}function includes(e,r){for(var t=0;t&lt;e.length;t++)if(e[t]==r)return!0;return!1}function digest(e){for(var r=5381,t=e.length;t;)r=33*r^e.charCodeAt(--t);return r&gt;&gt;&gt;0}function isValidIPAddress(e){return!!RegExp("^([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])\\.([01]?[0-9]?[0-9]|2[0-4][0-9]|25[0-5])$").test(e)||!!RegExp("^((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*::((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4}))*|((?:[0-9A-Fa-f]{1,4}))((?::[0-9A-Fa-f]{1,4})){7}$").test(e)}function isValidMACAddress(e){return RegExp("^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})|([0-9a-fA-F]{4}\\.[0-9a-fA-F]{4}\\.[0-9a-fA-F]{4})$").test(e)}function generateID(){var e="";arr="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var r=6;r&gt;0;r--)e+=arr[Math.floor(Math.random()*arr.length)];return e}function insertOrUpdate(e){var r={},t=now();null==e.unique_pairs&amp;&amp;(e.unique_pairs=[]);try{var a=new GlideRecord(e.table);if(0!=e.unique_pairs.length){for(var i=0;i&lt;e.unique_pairs.length;i++)a.addQuery(e.unique_pairs[i][0],e.unique_pairs[i][1]);a.query()}if(0==a.getRowCount()){a.initialize();for(i=0;i&lt;e.unique_pairs.length;i++)a[e.unique_pairs[i][0]]=e.unique_pairs[i][1];for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.insert(),r.operation="insert"}else{for(i=0;i&lt;e.update_pairs.length;i++)a[e.update_pairs[i][0]]=e.update_pairs[i][1];a.updateMultiple(),r.operation="update"}}catch(e){r.operation="error: "+e}return r.time_delta=now()-t,r}function writeToActionLog(e){var r={table:"x_fmcna_armis_inte_armis_action_log"};return r.unique_pairs=[["execution_id",e.id]],r.update_pairs=[["action_type",e.action_type],["api_time",e.api_time],["heavy_processing_time",e.heavy_processing_time],["total_time",e.total_time],["report",(""+e.report).substring(0,199)],["debug_string",(""+e.debug_string).substring(0,1999)]],insertOrUpdate(r)}function writeToErrorLog(e){var r={table:"x_fmcna_armis_inte_armis_error_log"};return r.unique_pairs=[["execution_id",e.id]],r.update_pairs=[["error_message",e.error_message],["debug_string",e.debug_string]],insertOrUpdate(r)}function getConfigValue(e){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_configuration");return r.addQuery("key",e),r.query(),0==r.getRowCount()?"":(r.next(),r.getValue("value"))}function getCacheValue(e,r){var t=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");if(t.addQuery("key",e),t.query(),0==t.getRowCount())return null;switch(t.next(),r){case"str":return t.getValue("value_string");case"int":return t.getValue("value_int");case"datetime":return t.getValue("value_datetime")}}function getCurrentToken(){return getCacheValue("token","str")}function setCacheValue(e,r,t){var a={table:"x_fmcna_armis_inte_armis_integration_cache"};switch(a.unique_pairs=[["key",e]],t){case"str":a.update_pairs=[["value_string",r]];break;case"int":a.update_pairs=[["value_int",r]];break;case"datetime":a.update_pairs=[["value_datetime",r]]}return insertOrUpdate(a)}function deleteCacheValue(e){var r=new GlideRecord("x_fmcna_armis_inte_armis_integration_cache");r.addQuery("key",e),r.query(),r.deleteMultiple()}


//'TABLES AND REST' FUNCTION LIBRARY v0.13 MINIFIED
//SEE FUNCTION_LIBRARY ACTION FOR DOCUMENTATION AND FULL VERSION
function writeToAPILog(e){null==e.payload&amp;&amp;(e.payload=""),null==e.response_body&amp;&amp;(e.response_body="");var t={table:"x_fmcna_armis_inte_armis_rest_api_log"};return t.update_pairs=[["execution_id",e.id],["api_endpoint",e.endpoint],["payload",(""+e.payload).substring(0,1999)],["response_code",e.response_code],["response_body",(""+e.response_body).substring(0,1999)],["query_submitted_at",e.start_time],["query_response_time_ms",e.time_delta_ms]],insertOrUpdate(t)}function queueProperty(e){if(null==e.name||""==e.name)return{operation:"error: empty name",time_delta:0};if(null==e.value||""==e.value)return{operation:"error: empty value",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_property_upload"};return t.unique_pairs=[["armis_device_id",e.armis_id],["property_name",e.name]],t.update_pairs=[["property_value",e.value],["execution_id",e.execution_id],["status","PENDING"]],insertOrUpdate(t)}function queueARP(e){if(null==e.mac||""==e.mac)return{operation:"error: empty mac",time_delta:0};if(null==e.ip||""==e.ip)return{operation:"error: empty ip",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_arp_table"};return t.update_pairs=[["execution_id",e.execution_id],["mac",e.mac],["ip",e.ip],["status","PENDING"]],insertOrUpdate(t)}function queueKeyAttribute(e){if(!(null!=e.armis_id&amp;&amp;""!=e.armis_id||null!=e.mac&amp;&amp;""!=e.mac))return{operation:"error: must have either a MAC or an Armis ID",time_delta:0};if(allowed_attributes=["CATEGORY","IP","LAST_SEEN","MODEL","NAME","OS","OS_VERSION","TAG","TYPE","USER"],0==includes(allowed_attributes,e.attribute))return{operation:"error: attribute '"+e.attribute+"' is not valid.",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_key_attribute"};return t.unique_pairs=[["armis_mac",e.mac],["attribute",e.attribute]],t.update_pairs=[["execution_id",e.execution_id],["armis_device_id",e.armis_id],["value",e.value],["status","PENDING"]],insertOrUpdate(t)}function queueApplication(e){if(null==e.armis_id||""==e.armis_id)return{operation:"error: Armis ID cannot be empty",time_delta:0};if(null==e.name||""==e.name)return{operation:"error: Software name cannot be empty",time_delta:0};var t={table:"x_fmcna_armis_inte_armis_op_application_upload"};return t.unique_pairs=[["armis_device_id",e.armis_id],["application_name",e.name]],t.update_pairs=[["execution_id",e.execution_id],["application_version",e.version],["status","PENDING"]],insertOrUpdate(t)}function executeStandardREST(e){try{var t=new GlideDateTime,i=new sn_ws.RESTMessageV2("Armis API",e.endpoint);i.setRequestHeader("Authorization",getCurrentToken()),i.setRequestHeader("accept","application/json"),i.setRequestHeader("content-type","application/json"),null==e.query_params&amp;&amp;(e.query_params=[]);for(var a=0;a&lt;e.query_params.length;a++)i.setQueryParameter(e.query_params[a][0],e.query_params[a][1]);i.setRequestBody(e.payload);var r,n=now(),s={};return 1==e.async?r=i.executeAsync():(r=i.execute(),s.response_code=r.getStatusCode(),s.response_body=r.getBody()),s.api_time=now()-n,writeToAPILog({id:e.id,endpoint:e.endpoint,payload:e.payload,response_code:s.response_code,response_body:s.response_body,start_time:t,time_delta_ms:s.api_time}),s}catch(e){return(s={response_code:"xx"}).response_body="Failed to build query. "+e,s.api_time=0,s}}function queueAttachmentREST(e){var t=new GlideRecord("sys_attachment"),i=(new GlideSysAttachment).write(t,e.id+".csv","text/plain",e.payload),a=new GlideRecord("x_fmcna_armis_inte_armis_attachment_upload");a.initialize(),a.attachment=i,a.execution_id=e.id,a.status="PENDING",a.type=e.type,a.content=e.payload,a.insert()}function getBestMAC(e){if(isValidMACAddress(e.mac_address)&amp;&amp;!e.mac_address.endsWith("00:00:01"))return e.mac_address;var t=new GlideRecord("cmdb_ci_network_adapter");t.addQuery("cmdb_ci",e.sys_id),t.query();for(var i=null,a=-1e3;t.next();)if(isValidMACAddress(t.mac_address)&amp;&amp;!t.mac_address.endsWith("00:00:01")){var r=0;t.ip_address.startsWith("10.")&amp;&amp;(r+=1e3),t.name.startsWith("Local Area")&amp;&amp;(r+=900);var n=new GlideAggregate("cmdb_ci_network_adapter");n.addAggregate("COUNT"),n.addQuery("mac_address",t.mac_address),n.query(),n.next()&amp;&amp;(r-=n.getAggregate("COUNT")),r&gt;a&amp;&amp;r&gt;0&amp;&amp;(i=""+t.mac_address,a=r)}return i}function queueInitialARPandCSV(e,t){var i=getBestMAC(e),a=e.ip_address;isValidMACAddress(i)&amp;&amp;isValidIPAddress(a)&amp;&amp;(queueARP({execution_id:t,mac:i,ip:a}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"NAME",value:""+e.name}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"IP",value:a}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"TAG",value:getConfigValue("armis_import_universal_tag")}),queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"LAST_SEEN",value:(new GlideDateTime).getDisplayValue().replace(" ","T")}),null!=e.model_id&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"MODEL",value:e.model_id.getDisplayValue()}),null!=e.os&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"OS",value:e.os.getDisplayValue()}),null!=e.os_version&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"OS_VERSION",value:e.os_version}),null!=e.users&amp;&amp;queueKeyAttribute({execution_id:t,armis_id:"",mac:i,attribute:"USER",value:e.users}))}function getPendingRecordsEndSysID(e,t,i){null==i&amp;&amp;(i={}),null==i.force_field&amp;&amp;(i.force_field="status"),null==i.force_pending&amp;&amp;(i.force_pending="PENDING");var a=new GlideRecord(t);for(a.addQuery(i.force_field,i.force_pending),a.setLimit(e),a.orderBy("sys_id"),a.query();a.next();)if(0==a.hasNext())return a.getValue("sys_id");return null}function getNumPendingRecords(e,t,i,a){null==a&amp;&amp;(a={}),null==a.force_field&amp;&amp;(a.force_field="status"),null==a.force_pending&amp;&amp;(a.force_pending="PENDING");var r=new GlideRecord(t);return r.addQuery(a.force_field,a.force_pending),r.setLimit(e),r.orderBy("sys_id"),r.addQuery("sys_id","&lt;=",i),r.query(),r}






(function execute(inputs, outputs) {
 
  var start_time = now()
  var eid = generateID()
  var lap = now()
  var error_report = ''
  var report_string = ''
  var num_properties = 0
  var debug = ['BEGIN DEVICE ' + inputs.computer_sys_id]
  
  
  try 
  {
    //Grab the computer associated with this sys_id, kill process if none.
    //(Doing this because I've had cases where a trigger occurs on a device that doesn't end up actually existing, 'tis weird
    if(inputs.computer_sys_id == '') { return }
    var snow_device = new GlideRecord('cmdb_ci_computer')
    snow_device.addQuery('sys_id',inputs.computer_sys_id)
    snow_device.query()
    if(!snow_device.next()) { return }
    
    report_string += "Computer '" + snow_device.name + "': "

    debug.push("SNOW Device: '" + snow_device.name + "' " + lapReport(lap));lap=now()

    //STEP ONE -- DOES THIS DEVICE HAVE A LINKED ARMIS DEVICE?


    var armis_device = new GlideRecord('x_fmcna_armis_inte_armis_device_table')
    armis_device.addQuery('linked_snow_computer',inputs.computer_sys_id)
    armis_device.query()
    if(!armis_device.next())
    {
      //No Armis device. Queue a novel device link push and exit.
      debug.push("No linked Armis device. Pushing ARP and CSV. "+ lapReport(lap));lap=now()
      report_string += 'no link, pushed ARP and CSV values.'
      queueInitialARPandCSV(snow_device,eid)
      debug.push("Queued. "+ lapReport(lap));lap=now()
    }
    else
    {
      debug.push("Linked Armis device '" + armis_device.name + "'. Proceeding to update. "+ lapReport(lap));lap=now()

      //STEP TWO -- ITERATE THROUGH FIELDS, AND IF ANY MATCH, QUEUE THOSE PROPERTIES.

      //Combine property references (did multiple config fields for extensibility)
      var property_reference = getConfigValue('snow_property_reference_1') + getConfigValue('snow_property_reference_2') + getConfigValue('snow_property_reference_3')
      property_reference = property_reference.split(',')

      //Split propertes. We will end up with a dictionary of the form { field_name: 'display value'} that we will use to govern what gets sent to Armis.
      var property_dictionary = {}
      for(var i=0;i&lt;property_reference.length;i++) { var p = property_reference[i].split(':'); property_dictionary[p[0]] = p[1] }

      //Iterate through our given update fields. Note that these are an array in the form of:
      /* [{
        "previous_display_value": "internal_2008T-OS_5.0.376a",
        "previous_value": "internal_2008T-OS_5.0.376a",
        "current_display_value": "internal_2008T-OS_5.0.376",
        "current_value": "internal_2008T-OS_5.0.376",
        "field_name": "u_image"
      }] */

      for(var i=0;i&lt;inputs.fields.length;i++)
      {
        var field_name = inputs.fields[i].field_name
        if (field_name in property_dictionary)
        {
          var display_value = inputs.fields[i].current_display_value
          queueProperty({armis_id: armis_device.armis_device_id, execution_id: eid, name: property_dictionary[field_name], value: display_value})
          debug.push( field_name + ": queued property upload of value '" + display_value + "' "+ lapReport(lap));lap=now()
          num_properties++

          //Some specific field names need to be pushed as CSV uploads too.
          switch(field_name)
          {
            case 'name':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'NAME', value: display_value})
              debug.push("NAME" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'ip_address':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'IP', value: display_value})
              debug.push("IP" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'model_id':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'MODEL', value: display_value})
              debug.push("MODEL" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'os':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'OS', value: display_value})
              debug.push("OS" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'os_version':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'OS_VERSION', value: display_value})
              debug.push("OS_VERSION" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
            case 'assigned_to':
              queueKeyAttribute({execution_id: eid, armis_id: armis_device.armis_device_id, mac: '' + armis_device.mac_address, attribute: 'USER', value: display_value})
              debug.push("USER" + ": Queued CSV upload of  value '" + display_value + "' "+ lapReport(lap));lap=now()
              break;
          }
        report_string += 'queued ' + num_properties + ' for upload.'
        }
        else
        {
          //This isn't a field we're interested in.
          debug.push( field_name + ": no upload needed "+ lapReport(lap));lap=now()
        }
      }
    }
  }
  catch(ex)
  {
    error_report = '[ERROR: ' + ex + '] '
    debug.push(error_report)
    writeToErrorLog({id: eid, error_message: ex, debug_string: debug.join('\n')})
    
  }
  
  debug = debug.join('\n')
  report_string = error_report + report_string
  outputs.debug = debug
  writeToActionLog({id: eid, action_type: 'trigger_computer_update', total_time: (now() - start_time), api_time: 0, heavy_processing_time: (now() - start_time), report: report_string, debug_string: debug})
  
})(inputs, outputs);
</value>
        <variable display_value="">71aa7f6647032200b4fad7527c9a719b</variable>
    </sys_variable_value>
    <sys_variable_value action="INSERT_OR_UPDATE">
        <document>sys_hub_step_instance</document>
        <document_key>df44bb0a1bde58104be764e8bc4bcbff</document_key>
        <order>400</order>
        <sys_class_name>sys_variable_value</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>9f44fb0a1bde58104be764e8bc4bcb3e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <value>35aa573fd7802200bdbaee5b5e610375</value>
        <variable display_value="">f5e56d79b3101300176b051a16a8dce4</variable>
    </sys_variable_value>
    <sys_element_mapping action="delete_multiple" query="id=df44bb0a1bde58104be764e8bc4bcbff"/>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>application</field>
        <id>df44bb0a1bde58104be764e8bc4bcbff</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>5b44fb0a1bde58104be764e8bc4bcb3e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>computer_sys_id</field>
        <id>df44bb0a1bde58104be764e8bc4bcbff</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>db44fb0a1bde58104be764e8bc4bcb3f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_df44bb0a1bde58104be764e8bc4bcbff</table>
        <value>{{action.computer_sys_id}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>fields</field>
        <id>df44bb0a1bde58104be764e8bc4bcbff</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>9f44fb0a1bde58104be764e8bc4bcb3f</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table>var__m_sys_hub_step_ext_input_df44bb0a1bde58104be764e8bc4bcbff</table>
        <value>{{action.fields}}</value>
    </sys_element_mapping>
    <sys_element_mapping action="INSERT_OR_UPDATE">
        <field>script</field>
        <id>df44bb0a1bde58104be764e8bc4bcbff</id>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_id>1f44fb0a1bde58104be764e8bc4bcb3e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table>var__m_sys_flow_step_definition_input_106afb6647032200b4fad7527c9a71e7</table>
        <value/>
    </sys_element_mapping>
    <sys_hub_step_ext_input action="delete_multiple" query="model=df44bb0a1bde58104be764e8bc4bcbff^sys_idNOT IN1f44fb0a1bde58104be764e8bc4bcb02,d744fb0a1bde58104be764e8bc4bcb09"/>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>fields</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>fields</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">df44bb0a1bde58104be764e8bc4bcbff</model>
        <model_id>df44bb0a1bde58104be764e8bc4bcbff</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_df44bb0a1bde58104be764e8bc4bcbff</name>
        <next_element/>
        <order>0</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>1f44fb0a1bde58104be764e8bc4bcb02</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_input action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>computer_sys_id</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>computer_sys_id</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">df44bb0a1bde58104be764e8bc4bcbff</model>
        <model_id>df44bb0a1bde58104be764e8bc4bcbff</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_input_df44bb0a1bde58104be764e8bc4bcbff</name>
        <next_element/>
        <order>100</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_input</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>d744fb0a1bde58104be764e8bc4bcb09</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_input>
    <sys_hub_step_ext_output action="delete_multiple" query="model=df44bb0a1bde58104be764e8bc4bcbff^sys_idNOT IN5344fb0a1bde58104be764e8bc4bcb10"/>
    <sys_hub_step_ext_output action="INSERT_OR_UPDATE">
        <active>true</active>
        <array>false</array>
        <array_denormalized>false</array_denormalized>
        <attributes>element_mapping_provider=com.glide.flow_design.action.data.FlowDesignVariableMapper,uiType=string,uiTypeLabel=String,uiUniqueId=312462aa-8d91-4371-bcb5-f1571b47d036</attributes>
        <audit>false</audit>
        <calculation><![CDATA[(function calculatedFieldValue(current) {

	// Add your code here
	return '';  // return the calculated value

})(current);]]></calculation>
        <choice/>
        <choice_field/>
        <choice_table/>
        <column_label/>
        <comments/>
        <create_roles/>
        <default_value/>
        <defaultsort/>
        <delete_roles/>
        <dependent/>
        <dependent_on_field/>
        <display>false</display>
        <dynamic_creation>false</dynamic_creation>
        <dynamic_creation_script/>
        <dynamic_default_value/>
        <dynamic_ref_qual/>
        <element>debug</element>
        <element_reference>false</element_reference>
        <foreign_database/>
        <function_definition/>
        <function_field>false</function_field>
        <help/>
        <hint/>
        <internal_type display_value="String">string</internal_type>
        <label>debug</label>
        <mandatory>true</mandatory>
        <max_length>8000</max_length>
        <model display_value="Script step">df44bb0a1bde58104be764e8bc4bcbff</model>
        <model_id>df44bb0a1bde58104be764e8bc4bcbff</model_id>
        <model_table>sys_hub_step_instance</model_table>
        <name>var__m_sys_hub_step_ext_output_df44bb0a1bde58104be764e8bc4bcbff</name>
        <next_element/>
        <order>1</order>
        <primary>false</primary>
        <read_only>false</read_only>
        <read_roles/>
        <reference/>
        <reference_cascade_rule/>
        <reference_floats>false</reference_floats>
        <reference_key/>
        <reference_qual/>
        <reference_qual_condition/>
        <reference_type/>
        <sizeclass/>
        <spell_check>false</spell_check>
        <staged>false</staged>
        <sys_class_name>sys_hub_step_ext_output</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>5344fb0a1bde58104be764e8bc4bcb10</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package/>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <table_reference>false</table_reference>
        <text_index>false</text_index>
        <unique>false</unique>
        <use_dependent_field>false</use_dependent_field>
        <use_dynamic_default>false</use_dynamic_default>
        <use_reference_qualifier>simple</use_reference_qualifier>
        <virtual>false</virtual>
        <widget/>
        <write_roles/>
        <xml_view>false</xml_view>
    </sys_hub_step_ext_output>
    <sys_documentation action="delete_multiple" query="name=var__m_sys_hub_action_input_8344bb0a1bde58104be764e8bc4bcbee^sys_idNOT INd344bb0a1bde58104be764e8bc4bcbfd,df44bb0a1bde58104be764e8bc4bcbf6"/>
    <sys_documentation action="INSERT_OR_UPDATE">
        <element>computer_sys_id</element>
        <help/>
        <hint/>
        <label>computer_sys_id</label>
        <language>en</language>
        <name>var__m_sys_hub_action_input_8344bb0a1bde58104be764e8bc4bcbee</name>
        <plural/>
        <sys_class_name>sys_documentation</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>d344bb0a1bde58104be764e8bc4bcbfd</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package display_value="Armis Integration" source="x_fmcna_armis_inte">7574b5e3dbf4d050cb24431e13961986</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <url/>
        <url_target/>
    </sys_documentation>
    <sys_documentation action="INSERT_OR_UPDATE">
        <element>fields</element>
        <help/>
        <hint/>
        <label>fields</label>
        <language>en</language>
        <name>var__m_sys_hub_action_input_8344bb0a1bde58104be764e8bc4bcbee</name>
        <plural/>
        <sys_class_name>sys_documentation</sys_class_name>
        <sys_created_by>3244578</sys_created_by>
        <sys_created_on>2020-07-31 02:26:06</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_id>df44bb0a1bde58104be764e8bc4bcbf6</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name/>
        <sys_package display_value="Armis Integration" source="x_fmcna_armis_inte">7574b5e3dbf4d050cb24431e13961986</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Armis Integration">7574b5e3dbf4d050cb24431e13961986</sys_scope>
        <sys_update_name/>
        <sys_updated_by>3244578</sys_updated_by>
        <sys_updated_on>2020-07-31 02:26:06</sys_updated_on>
        <url/>
        <url_target/>
    </sys_documentation>
</record_update>
